/**
 * @preserve
 * JS Scripts for Roles & Rules B2B for WooCommerce
 * by Consortia AS
 * @package rrb2b/js
 * @endpreserve
 */
!function(e){const t=new URL(window.location.href);var o=t.searchParams.get("tab");function r(e,t){jQuery.ajax({type:"POST",url:e,datatype:"json",data:t,success:function(e){a(200)},error:function(e){}})}function a(e){setTimeout((function(){location.reload()}),e)}function c(t,o){if("start"===t){e("#rrb2b-saving-"+o).removeClass("rrb2b-saving").addClass("rrb2b-saving-show");var r=0;setInterval((function(){r>100&&(r=0),e("#pbar-saving-"+o).val(r),r+=5}),50)}else e("#rrb2b-saving-"+o).removeClass("rrb2b-saving-show").addClass("rrb2b-saving")}function l(t){e("#prod1_"+t).toggle(),e("#prod2_"+t).toggle()}jQuery(document).ready((function(e){void 0!==e.fn.tooltip&&e.fn.tooltip.Constructor&&e.fn.tooltip.Constructor.VERSION||e(document).tooltip();const r=e("body");if(!(!cyp_object.use_dark_mode||"yes"!==cyp_object.use_dark_mode)?r.addClass("dark-mode"):r.removeClass("dark-mode"),e('input[name="date_from"]').datepicker(),e('input[name="date_to"]').datepicker(),"rules"===(o=null===o?"rules":o)&&(e('select[name="reduce_regular_type"]').select2({placeholder:"Select reduction or increase type",multiple:!1,allowClear:!0,width:"100%"}),e('select[name="coupon"]').select2({placeholder:cyp_object.select_coupon,multiple:!1,allowClear:!0,width:"300px"}),e("#product_filter_role").select2({placeholder:cyp_object.filter_by_role,multiple:!1,allowClear:!0,width:"250px"}),e("#select_role_to_add").select2({placeholder:cyp_object.select_role,multiple:!1,allowClear:!0,width:"300px"}),e("#select_role_to_add").val(null).trigger("change"),e('select[name="reduce_categories"]').select2({placeholder:cyp_object.select_categories,multiple:!0,closeOnSelect:!1,allowClear:!0,width:"100%"}),e('select[name="reduce_categories"]').each((function(){var t=this.id.split("reduce_categories_list_")[1],o=e("#selected_categories_"+t).val();if(o){var r=o.split(",");e(this).val(r).trigger("change")}else e(this).val(null).trigger("change")})),e('select[name="reduce_categories"]').on("change",(function(){var t=this.id.split("reduce_categories_list_")[1],o=e(this).val(),r=o?o.join(","):"";e("#selected_categories_"+t).val(r)}))),"categories"===o&&(e('select[name="product_cat_to_add"]').on("change",rrb2bSetSelectedCategories),e('select[name="product_cat_to_add"]').select2({placeholder:cyp_object.add_categories,multiple:!0,closeOnSelect:!1,allowClear:!0,width:"300px"}),e("#category_filter_role").select2({placeholder:cyp_object.filter_by_role,multiple:!1,allowClear:!0,width:"250px"}),e("#copy_category_rule_from").select2({placeholder:cyp_object.rule_to_copy,multiple:!1,allowClear:!0,width:"300px"}),e("#copy_category_rule_to").select2({placeholder:cyp_object.rule_destination,multiple:!0,closeOnSelect:!1,allowClear:!0,width:"100%"}),e("#copy_category_rule_from").val(null).trigger("change"),e("#copy_category_rule_to").val(null).trigger("change"),e('select[name="product_cat_to_add"]').val(null).trigger("change")),"products"===o){var a=t.searchParams.get("role");a&&l(a),e(".dropdown_product_cat").select2({placeholder:cyp_object.add_cat_products,multiple:!1,allowClear:!0,width:"resolve"}),e("#product_filter_role").select2({placeholder:cyp_object.filter_by_role,multiple:!1,allowClear:!0,width:"250px"}),e("#copy_product_rule_from").select2({placeholder:cyp_object.rule_to_copy,multiple:!1,allowClear:!0,width:"300px"}),e("#copy_product_rule_to").select2({placeholder:cyp_object.rule_destination,multiple:!0,closeOnSelect:!1,allowClear:!0,width:"100%"}),e("#copy_product_rule_from").val(null).trigger("change"),e("#copy_product_rule_to").val(null).trigger("change")}})),window.rrb2bCopyCategoryRules=function(){var t=[],o=e("#copy_category_rule_from option:selected").val();e("#copy_category_rule_to option:selected").each((function(){""!==this.value&&t.push(this.value)})),e("#copy_category_rule_from").val(null).trigger("change"),e("#copy_category_rule_to").val(null).trigger("change");var r={action:"rrb2b_copy_rules_to",nonce:e("#_wpnonce").val(),type:"category",from:o,to:t.toString()};e.ajax({type:"POST",url:ajaxurl,datatype:"json",data:r,success:function(t){a(200),e(".cas-notice3").show()},error:function(e){}})},window.rrb2bCopyProductRules=function(){var t=[],o=e("#copy_product_rule_from option:selected").val();e("#copy_product_rule_to option:selected").each((function(){""!==this.value&&t.push(this.value)})),e("#copy_product_rule_from").val(null).trigger("change"),e("#copy_product_rule_to").val(null).trigger("change");var r={action:"rrb2b_copy_rules_to",nonce:e("#_wpnonce").val(),type:"product",from:o,to:t.toString()};e.ajax({type:"POST",url:ajaxurl,datatype:"json",data:r,success:function(t){a(200),e(".cas-notice3").show()},error:function(e){}})},window.rrb2bFindDuplicates=function(t,o){!function(t,o){var r={},a="product"===o?"product_remove":"category_remove";for(var c in e("#"+t+" tbody tr").each((function(){var e=this.children[0].children[0],t=e.id.value;r[t]?r[t].push(e):r[t]=[e]})),r)if(r[c].length>1){var l=0;r[c].forEach((function(t){l>0&&(t[a].checked=!0,e(t).closest("tr").addClass("duplicate-row")),l++}))}}(t,o)},window.clearSale=function(t){!function(t){var o=e(t.form)[0];o.reduce_sale_value.value="",o.date_from.value="",o.date_to.value="",o.reduce_sale_type.value="",o.time_from.value="00:00",o.time_to.value="23:59"}(t)},window.formChanged=function(t){!function(t){e("#btn_"+t).css("color","red"),e("#msg_"+t).css("display","block")}(t)},window.deleteRule=function(t){!function(t){if(!0===confirm(e("#msg-confirm-delete").val())){var o=e(t.form)[0],a={action:"rrb2b_delete_rule_callback",nonce:e("#_wpnonce").val(),role_id:o.id.value};r(ajaxurl,a),event.preventDefault()}}(t)},window.sendJson=function(e,t){r(e,t)},window.reloadPage=function(e){a(e)},window.findCategoryProducts=function(t){!function(t){var o=e("#_wpnonce").val(),r=e("#rrb2b-select-category-"+t)[0].elements,a={action:"rrb2b_ajax_get_products_category",nonce:o,page:r.page.value,tab:r.tab.value,category:r.product_cat.value,id:r["rule-id"].value,variations:r.variations.checked};c("start",t),e.ajax({type:"POST",url:ajaxurl,datatype:"json",data:a,success:function(e){let o=new URL(window.location.href);o.searchParams.set("role",t),window.location.href=o.toString()},error:function(e){c("stop",t)}}),event.preventDefault()}(t)},window.findProducts=function(t){!function(t){var o={action:"rrb2b_ajax_get_products",nonce:e("#_wpnonce").val(),search:""};e("#product_search_"+t).autocomplete({source:function(t,r){o.search=t.term,e.ajax({url:ajaxurl,data:o,dataType:"json",success:function(e){r(e)}})},minLength:2,select:function(o,r){var a=e("#product_add_"+t).attr("href");e("#product_add_"+t).attr("href",a+r.item.data+"&name="+r.item.value)}})}(t)},window.rrb2b_filter_products=function(t){!function(t){var o=e("#rrb2b_table_"+t+" tbody tr"),r=e("#product_filter_"+t).val(),a=[];r.length>0&&(r=r.toLowerCase().replace(",",""),a=r.split(" ")),o.each((function(){var e=this.children[1].children[1].value;if(e.length>0){for(var t=e.toLowerCase(),o=0,r=0;r<a.length;r++)t.match(a[r])&&o++;o===a.length?this.style.display="":this.style.display="none"}}))}(t)},window.rrb2b_filter_categories=function(t){!function(t){var o=e("#rrb2b_table_cat_"+t+" tbody tr"),r=e("#category_filter_"+t).val(),a=[];r.length>0&&(r=r.toLowerCase().replace(",",""),a=r.split(" ")),o.each((function(){var e=this.children[0].children[0][3].value,t=this.children[0].children[0][1].value;if(t.length>0){for(var o=t.toLowerCase(),r=0,c=0;c<a.length;c++)(o.match(a[c])||e.toLowerCase().match(a[c]))&&r++;r===a.length?this.style.display="":this.style.display="none"}}))}(t)},window.updateProducts=function(t){!function(t){var o=e("#_wpnonce").val(),r={action:"rrb2b_ajax_update_product_rule",rule_id:t,nonce:o,rows:[]},a=0;e("#updateButton-"+t).removeClass("button-primary"),e(".notice-info").hide(),e("#rrb2b_table_"+t+" tbody tr").each((function(){var o=this.children[1].children[0].form.elements,c=o.product_remove.checked,l={rule_id:t,remove:c,product_id:o.product_id.value,product_hidden:o.product_hidden.checked,product_name:o.product_name.value,reduce_type:o.reduce_regular_type.value,reduce_value:o.adjust_value.value,reduce_type_qty:o.reduce_regular_type_qty.value,reduce_value_qty:o.adjust_value_qty.value,min_qty:o.min_qty.value,is_variable:o.variable.value};r.rows.push(l),a++,c&&e(this).hide()})),a>0&&(localStorage.setItem("eid",t),c("start",t),e.ajax({type:"POST",url:ajaxurl,datatype:"json",data:r,success:function(o){e("#cas-notice-product-changed").show(),e("#prod1_"+t).show(),e("#prod2_"+t).show(),c("stop",t),e("#updateButton-"+t).addClass("button-primary")},error:function(e){c("stop",t)}})),event.preventDefault()}(t)},window.updateSingleCategories=function(t){!function(t){var o=e("#_wpnonce").val(),r={action:"rrb2b_ajax_update_single_category_rule",rule_id:t,nonce:o,rows:[]},a=0;e("#updateSingleCatButton-"+t).removeClass("button-primary"),e(".notice-info").hide(),e("#rrb2b_table_cat_"+t+" tbody tr").each((function(){var o=this.children[1].children[0].form.elements,c=o.category_remove.checked,l={rule_id:t,remove:c,id:o.id.value,hidden:o.category_hidden.checked,slug:o.slug.value,name:o.category_name.value,reduce_type:o.reduce_regular_type.value,reduce_value:o.adjust_value.value,sale:o.category_sale.checked,reduce_type_qty:o.reduce_regular_type_qty.value,reduce_value_qty:o.adjust_value_qty.value,min_qty:o.min_qty.value};r.rows.push(l),a++,c&&e(this).hide()})),a>0&&(localStorage.setItem("eid",t),e.ajax({type:"POST",url:ajaxurl,datatype:"json",data:r,success:function(o){e("#cas-notice-category-changed").show(),e("#div_"+t).show(),e("#cat_"+t).show(),e("#updateSingleCatButton-"+t).addClass("button-primary")},error:function(e){}})),event.preventDefault()}(t)},window.reloadPageArgs=function(e){!function(e){const t=new URL(window.location.href);t.searchParams.set("eid",localStorage.getItem("eid")),setTimeout((function(){window.location.href=t.toString()}),e)}(e)},window.rrb2b_delete_role=function(t,o){!function(t,o){var r={action:"rrb2b_delete_role",the_role:t,nonce:e("#_wpnonce").val()};confirm(cyp_object.delete_role_txt+" "+o+cyp_object.delete_role_confirm)&&e.ajax({type:"POST",url:ajaxurl,datatype:"json",data:r,success:function(e){a(100)},error:function(e){}}),event.preventDefault()}(t,o)},window.productFilterByRole=function(){var t=e("#product_filter_role :selected").val(),o=window.location.href;window.location.href=o+"&filter="+t},window.categoryFilterByRole=function(){var t=e("#category_filter_role :selected").val(),o=window.location.href;window.location.href=o+"&filter="+t},window.setCheckedCategories=function(t){!function(t){var o=e("#frm_single_categories_"+t)[0].rule_url.value,r=[];e("#product_cat_to_add_"+t+" option").each((function(){""!==this.value&&this.selected&&r.push(this.value)})),r.length>0&&e("#categories_add_"+t).attr("href",o+r.toString())}(t)},window.rrb2bSetSelectedCategories=function(){var t=e(this).closest("form")[0],o=t.rule_id.value,r=t.rule_url.value,a=[];e("#product_cat_to_add_"+o+" option").each((function(){""!==this.value&&this.selected&&a.push(this.value)})),a.length>0&&e("#categories_add_"+o).attr("href",r+a.toString())},window.checkCategories=function(t){!function(t){var o=e("#frm_single_categories_"+t)[0].rule_url.value,r=[];e("#product_cat_to_add_"+t+" option").each((function(){""!==this.value&&(this.selected=!0,r.push(this.value))})).trigger("change"),e("#categories_add_"+t).attr("href",o+r.toString())}(t)},window.progressBar=function(e,t){c(e,t)},window.checkForRemove=function(t,o){!function(t,o){var r=e("#"+o+"_"+t).prop("checked");e("#rrb2b_table_cat_"+t+' tbody input[name="'+o+'"]').attr("checked",r)}(t,o)},window.catBulkCheck=function(t,o,r){!function(t,o,r){var a=e("#"+o+"_"+t).prop("checked");e("#"+r+"_"+t+' tbody input[name="'+o+'"]:visible').attr("checked",a)}(t,o,r)},window.catBulkSelect=function(t,o,r){!function(t,o,r){var a=e("#"+o+"_"+t+" :selected").val();e("#"+r+"_"+t+' tbody select[name="'+o+'"]:visible').each((function(){this.value=a}))}(t,o,r)},window.catBulkInput=function(t,o,r){!function(t,o,r){var a=e("#"+o+"_"+t).val();e("#"+r+"_"+t+' tbody input[name="'+o+'"]:visible').each((function(){this.value=a}))}(t,o,r)},window.genCatCheck=function(t){!function(t){var o=e("#chk-all-cat_"+t).prop("checked"),r=[];e("#reduce_categories_list_"+t+" option").each((function(){""!==this.value&&(this.selected=o,o&&r.push(this.value))})).trigger("change"),e("#selected_categories_"+t).val(r.toString())}(t)},window.rrb2b_show_hidden=function(t){!function(t){var o=e("#"+t)[0].className;"rrb2b-collapsible"!==o?"rrb2b-collapsible-show"!==o||e("#"+t).removeClass("rrb2b-collapsible-show").addClass("rrb2b-collapsible"):e("#"+t).removeClass("rrb2b-collapsible").addClass("rrb2b-collapsible-show")}(t)},window.rrb2b_toggle_div_cat=function(t){!function(t){e("#div_"+t).toggle(),e("#cat_"+t).toggle()}(t)},window.rrb2b_toggle_div_prod=function(e){l(e)}}(jQuery);
(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var l in a)e.o(a,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:a[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{addRule:()=>y,deleteRule:()=>E,setError:()=>v,setLoading:()=>_,setRules:()=>g,updateRule:()=>h});var a={};e.r(a),e.d(a,{getError:()=>x,getRuleById:()=>b,getRules:()=>f,getRulesByRole:()=>C,isLoading:()=>w});var l={};e.r(l),e.d(l,{getRules:()=>S});const r=window.wp.element,n=window.React,o=window.wp.apiFetch;var c=e.n(o);const s=window.wp.data,i=window.wp.notices,u=()=>{const[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(!1),{createSuccessNotice:n,createErrorNotice:o}=(0,s.useDispatch)(i.store),u=async()=>{l(!0);try{const e=await c()({path:"/rrb2b/v1/roles",method:"GET"});t(e)}catch(e){const t=e instanceof Error?e.message:"Unknown error";o(`Failed to load roles: ${t}`),console.error("Error fetching roles:",e)}finally{l(!1)}};return(0,r.useEffect)(()=>{u()},[]),{roles:e,isLoading:a,createRole:async a=>{try{const l={role_name:a.name,role_slug:a.slug,role_cap:a.baseCap||"customer"},r=(await c()({path:"/rrb2b/v1/roles",method:"POST",data:l})).role;return t([...e,r]),n("Role created successfully!",{type:"snackbar"}),r}catch(e){const t=e instanceof Error?e.message:"Unknown error";throw o(`Failed to create role: ${t}`),e}},deleteRole:async a=>{const l=[...e];t(e.filter(e=>e.slug!==a));try{await c()({path:`/rrb2b/v1/roles/${a}`,method:"DELETE"}),n("Role deleted successfully!",{type:"snackbar"})}catch(e){t(l);const a=e instanceof Error?e.message:"Unknown error";throw o(`Failed to delete role: ${a}`),e}},refetch:u}},d=window.wp.components,m=({roles:e,isLoading:t,onSelectRole:a})=>t?(0,n.createElement)("div",{style:{padding:"20px",textAlign:"center"}},(0,n.createElement)(d.Spinner,null),(0,n.createElement)("p",null,"Loading roles...")):(0,n.createElement)("div",{className:"crp-rules-list-view",style:{marginTop:"20px"}},(0,n.createElement)("div",{style:{marginBottom:"20px"}},(0,n.createElement)("h2",null,"Pricing Rules Management"),(0,n.createElement)("p",null,"Select a role to configure its pricing rules, discounts, and category-specific settings.")),(0,n.createElement)(d.Card,null,(0,n.createElement)(d.CardBody,null,(0,n.createElement)("h3",null,"All Roles"),(0,n.createElement)("table",{className:"wp-list-table widefat fixed striped"},(0,n.createElement)("thead",null,(0,n.createElement)("tr",null,(0,n.createElement)("th",{style:{width:"35%"}},"Role Name"),(0,n.createElement)("th",{style:{width:"25%"}},"Slug"),(0,n.createElement)("th",{style:{width:"15%"}},"Users"),(0,n.createElement)("th",{style:{width:"25%"}},"Actions"))),(0,n.createElement)("tbody",null,0===e.length?(0,n.createElement)("tr",null,(0,n.createElement)("td",{colSpan:4,style:{textAlign:"center",padding:"20px"}},'No roles found. Create roles in the "Manage Roles" tab first.')):e.map(e=>{var t;return(0,n.createElement)("tr",{key:e.slug},(0,n.createElement)("td",null,(0,n.createElement)("strong",null,e.name)),(0,n.createElement)("td",null,(0,n.createElement)("code",null,e.slug)),(0,n.createElement)("td",null,null!==(t=e.user_count)&&void 0!==t?t:0),(0,n.createElement)("td",null,(0,n.createElement)(d.Button,{variant:"primary",onClick:()=>a(e.slug)},"Manage Pricing Rules →")))})))))),p={rules:[],isLoading:!1,error:null},g=e=>({type:"SET_RULES",rules:e}),y=e=>({type:"ADD_RULE",rule:e}),h=e=>({type:"UPDATE_RULE",rule:e}),E=e=>({type:"DELETE_RULE",id:e}),_=e=>({type:"SET_LOADING",isLoading:e}),v=e=>({type:"SET_ERROR",error:e}),f=e=>e.rules,b=(e,t)=>e.rules.find(e=>e.id===t),C=(0,s.createSelector)([e=>e.rules,(e,t)=>t],(e,t)=>t?e.filter(e=>e.role_name===t):e),w=e=>e.isLoading,x=e=>e.error,S=()=>async({dispatch:e})=>{e(_(!0));try{const t=await c()({path:"/rrb2b/v1/rules"});e(g(t))}catch(t){const a=t instanceof Error?t.message:"Failed to load rules";e(v(a)),console.error("Error fetching rules:",t)}finally{e(_(!1))}},k="rrb2b/rules",R=(0,s.createReduxStore)(k,{reducer:(e=p,t)=>{switch(t.type){case"SET_RULES":return{...e,rules:t.rules,error:null};case"ADD_RULE":return{...e,rules:[...e.rules,t.rule]};case"UPDATE_RULE":return{...e,rules:e.rules.map(e=>e.id===t.rule.id?t.rule:e)};case"DELETE_RULE":return{...e,rules:e.rules.filter(e=>e.id!==t.id)};case"SET_LOADING":return{...e,isLoading:t.isLoading};case"SET_ERROR":return{...e,error:t.error};default:return e}},actions:t,selectors:a,resolvers:l});(0,s.register)(R);const N=e=>{const{rules:t,isLoading:a,error:l}=(0,s.useSelect)(t=>{const a=t(k).getRules();return{rules:e?t(k).getRulesByRole(e):a,isLoading:t(k).isLoading(),error:t(k).getError()}},[e]),{addRule:r,updateRule:n,deleteRule:o,invalidateResolution:u}=(0,s.useDispatch)(k),{createSuccessNotice:d,createErrorNotice:m}=(0,s.useDispatch)(i.store),p=async(e,a)=>{const l=t.find(t=>t.id===e);l&&n({...l,...a});try{const t=await c()({path:`/rrb2b/v1/rules/${e}`,method:"PUT",data:a});return n(t),d("Rule updated successfully!",{type:"snackbar"}),t}catch(e){l&&n(l);const t=e instanceof Error?e.message:"Failed to update rule";throw m(`Failed to update rule: ${t}`),e}},g=async e=>{o(e);try{await c()({path:`/rrb2b/v1/rules/${e}`,method:"DELETE"}),d("Rule deleted successfully!",{type:"snackbar"})}catch(e){const t=e instanceof Error?e.message:"Failed to delete rule";throw m(`Failed to delete rule: ${t}`),e}};return{rules:t,isLoading:a,error:l,createRule:async e=>{try{const t={role_name:e.role},a=await c()({path:"/rrb2b/v1/rules",method:"POST",data:t});if(e.products&&e.products.length>0){const t=e.products.map((t,a)=>{const l=e.productDetails?.[a];return{product_id:t,product_name:l?.name||"",type:e.rule_type||"percentage",value:e.rule_value||"0",min_qty:1}});await c()({path:`/rrb2b/v1/rules/${a.id}/products`,method:"PUT",data:{rows:t}})}if(e.single_categories&&e.single_categories.length>0){const t=e.single_categories.map(t=>({category_id:t,type:e.rule_type||"percentage",value:e.rule_value||"0",min_qty:0}));await c()({path:`/rrb2b/v1/rules/${a.id}/categories`,method:"PUT",data:{rows:t}})}(void 0!==e.active||e.rule_type||e.rule_value)&&await c()({path:`/rrb2b/v1/rules/${a.id}`,method:"PUT",data:{rule_active:e.active,global_rule:e.rule_type&&e.rule_value?{type:e.rule_type,value:e.rule_value}:void 0}});const l=await c()({path:`/rrb2b/v1/rules/${a.id}`,method:"GET"});return r(l),d("Rule created successfully!",{type:"snackbar"}),l}catch(e){const t=e instanceof Error?e.message:"Failed to create rule";throw m(`Failed to create rule: ${t}`),e}},updateRule:p,deleteRule:g,toggleActive:async e=>{const a=t.find(t=>t.id===e);a&&await p(e,{rule_active:!a.rule_active})},copyRule:async(e,t)=>{try{(await c()({path:`/rrb2b/v1/rules/${e}/copy`,method:"POST",data:{destination_roles:t}})).forEach(e=>r(e)),d(`Rule copied to ${t.length} role(s) successfully!`,{type:"snackbar"})}catch(e){const t=e instanceof Error?e.message:"Failed to copy rule";throw m(`Failed to copy rule: ${t}`),e}},bulkUpdate:async(e,t)=>{try{const a=e.map(e=>p(e,t));await Promise.all(a),d(`${e.length} rule(s) updated successfully!`,{type:"snackbar"})}catch(e){const t=e instanceof Error?e.message:"Failed to bulk update";throw m(`Bulk update failed: ${t}`),e}},bulkDelete:async e=>{try{const t=e.map(e=>g(e));await Promise.all(t),d(`${e.length} rule(s) deleted successfully!`,{type:"snackbar"})}catch(e){const t=e instanceof Error?e.message:"Failed to bulk delete";throw m(`Bulk delete failed: ${t}`),e}},refetch:()=>{u("getRules")}}},B=({value:e,onChange:t,roles:a,label:l="Select Role",disabled:r=!1})=>{const o=[{label:"Select Role",value:""},...a.map(e=>({label:e.name,value:e.slug}))];return(0,n.createElement)(d.SelectControl,{label:l,value:e,options:o,onChange:t,disabled:r})},T=()=>{const[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(!1),n=async()=>{l(!0);try{const e=await c()({path:"/wc/v3/products/categories?per_page=100"});t(e)}catch(e){console.error("Error fetching categories:",e),t([])}finally{l(!1)}};return(0,r.useEffect)(()=>{n()},[]),{categories:e,isLoading:a,fetchCategories:n}},P=({value:e,onChange:t,label:a="Categories"})=>{const{categories:l,isLoading:o}=T(),[c,s]=(0,r.useState)(!1),[i,u]=(0,r.useState)(""),m=(0,r.useMemo)(()=>l.filter(t=>e.includes(t.id)),[l,e]),p=(0,r.useMemo)(()=>i?l.filter(e=>e.name.toLowerCase().includes(i.toLowerCase())):l,[l,i]);return(0,n.createElement)("div",{className:"crp-category-multiselect"},(0,n.createElement)("label",{className:"components-base-control__label"},a),(0,n.createElement)("div",{className:"selected-categories",style:{marginBottom:"8px",display:"flex",flexWrap:"wrap",gap:"4px"}},0===m.length?(0,n.createElement)("span",{style:{color:"#757575",fontSize:"13px"}},"No categories selected"):m.map(a=>(0,n.createElement)("span",{key:a.id,className:"category-tag",style:{display:"inline-flex",alignItems:"center",padding:"4px 8px",background:"#f0f0f0",borderRadius:"4px",fontSize:"12px",gap:"6px"}},a.name,(0,n.createElement)("button",{onClick:()=>{return l=a.id,void t(e.filter(e=>e!==l));var l},style:{border:"none",background:"transparent",cursor:"pointer",padding:0,fontSize:"14px",lineHeight:1},"aria-label":`Remove ${a.name}`},"×")))),(0,n.createElement)(d.Button,{variant:"secondary",onClick:()=>s(!c)},c?"Close":"Select Categories"),c&&(0,n.createElement)(d.Popover,{position:"bottom left",onClose:()=>s(!1),className:"crp-category-popover"},(0,n.createElement)("div",{style:{width:"300px",padding:"12px"}},(0,n.createElement)(d.TextControl,{label:"Search",value:i,onChange:u,placeholder:"Search categories..."}),o?(0,n.createElement)("p",null,"Loading categories..."):(0,n.createElement)("div",{style:{maxHeight:"300px",overflowY:"auto",marginTop:"8px"}},0===p.length?(0,n.createElement)("p",{style:{color:"#757575",fontSize:"13px"}},"No categories found"):p.map(a=>(0,n.createElement)(d.CheckboxControl,{key:a.id,label:a.name,checked:e.includes(a.id),onChange:()=>{return l=a.id,void(e.includes(l)?t(e.filter(e=>e!==l)):t([...e,l]));var l}}))))))},q=[{label:"Select Type",value:""},{label:"Percentage Discount",value:"percentage"},{label:"Fixed Amount Discount",value:"fixed"},{label:"Fixed Price",value:"fixed_price"},{label:"Hide Price",value:"hide_price"}],L=({isOpen:e,title:t,message:a,onConfirm:l,onCancel:r,isDangerous:o=!1})=>e?(0,n.createElement)(d.Modal,{title:t,onRequestClose:r,className:"crp-confirm-dialog"},(0,n.createElement)("p",null,a),(0,n.createElement)("div",{className:"crp-modal-actions",style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"}},(0,n.createElement)(d.Button,{onClick:r},"Cancel"),(0,n.createElement)(d.Button,{variant:"primary",onClick:l,isDestructive:o},"Confirm"))):null,F=({roleFilter:e})=>{const[t,a]=(0,r.useState)(""),l=e||t,{roles:o,isLoading:c}=u(),{rules:s,isLoading:i,createRule:m,updateRule:p,deleteRule:g,toggleActive:y}=N(l),h=s.length>0?s[0]:null,[E,_]=(0,r.useState)(!1),[v,f]=(0,r.useState)(!1),[b,C]=(0,r.useState)({global_rule:h?.global_rule||{type:"",value:""},category_rule:h?.category_rule||{type:"",value:""},categories:h?.categories||[]});return(0,r.useState)(()=>{h&&C({global_rule:h.global_rule||{type:"",value:""},category_rule:h.category_rule||{type:"",value:""},categories:h.categories||[]})}),(0,n.createElement)("div",{className:"crp-rules-tab"},!e&&(0,n.createElement)("div",{style:{marginBottom:"20px"}},(0,n.createElement)("h2",null,"General Pricing Rules"),(0,n.createElement)("p",null,"Configure global pricing rules and category-specific rules for a role.")),!e&&(0,n.createElement)("div",{style:{marginBottom:"20px"}},(0,n.createElement)("div",{style:{maxWidth:"300px"}},(0,n.createElement)(B,{value:l,onChange:a,roles:o,label:"Select Role",disabled:c}))),l&&i&&(0,n.createElement)("div",{style:{display:"flex",justifyContent:"center",padding:"40px"}},(0,n.createElement)(d.Spinner,null)),l&&!i&&!h&&(0,n.createElement)(d.Card,null,(0,n.createElement)(d.CardBody,null,(0,n.createElement)("h3",null,"Create Rule for ",l),(0,n.createElement)("p",{style:{color:"#757575",fontSize:"13px"}},"No rule exists for this role yet. Create one to configure pricing settings."),(0,n.createElement)(d.Button,{variant:"primary",onClick:async()=>{if(l){f(!0);try{await m({role:l,rule_type:"percentage",rule_value:"0",active:!0})}catch(e){console.error("Failed to create rule:",e)}finally{f(!1)}}},isBusy:v,disabled:v},"Create Rule"))),l&&!i&&h&&(0,n.createElement)(d.Card,null,(0,n.createElement)(d.CardBody,null,(0,n.createElement)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"}},(0,n.createElement)("h3",{style:{margin:0}},"Pricing Rule for ",h.role_name),(0,n.createElement)(d.ToggleControl,{label:"Active",checked:h.rule_active,onChange:async()=>{h&&await y(h.id)}})),(0,n.createElement)("h4",null,"Global Rule"),(0,n.createElement)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"24px"}},(0,n.createElement)(d.SelectControl,{label:"Rule Type",value:b.global_rule?.type||"",options:q,onChange:e=>C({...b,global_rule:{...b.global_rule,type:e}})}),(0,n.createElement)(d.TextControl,{label:"Value",value:b.global_rule?.value||"",onChange:e=>C({...b,global_rule:{...b.global_rule,value:e}}),placeholder:"e.g., 10"})),(0,n.createElement)("h4",null,"Category Rule"),(0,n.createElement)("div",{style:{marginBottom:"16px"}},(0,n.createElement)(P,{value:b.categories||[],onChange:e=>C({...b,categories:e}),label:"Apply to Categories"})),b.categories&&b.categories.length>0&&(0,n.createElement)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"24px"}},(0,n.createElement)(d.SelectControl,{label:"Category Rule Type",value:b.category_rule?.type||"",options:q,onChange:e=>C({...b,category_rule:{...b.category_rule,type:e}})}),(0,n.createElement)(d.TextControl,{label:"Category Value",value:b.category_rule?.value||"",onChange:e=>C({...b,category_rule:{...b.category_rule,value:e}}),placeholder:"e.g., 15"})),(0,n.createElement)("div",{style:{display:"flex",gap:"10px",marginTop:"24px"}},(0,n.createElement)(d.Button,{variant:"primary",onClick:async()=>{if(h){f(!0);try{await p(h.id,b)}catch(e){console.error("Failed to save rule:",e)}finally{f(!1)}}},isBusy:v,disabled:v},"Save Changes"),(0,n.createElement)(d.Button,{variant:"secondary",isDestructive:!0,onClick:()=>_(!0),disabled:v},"Delete Rule")))),!l&&(0,n.createElement)("div",{className:"crp-empty-state"},(0,n.createElement)("p",{className:"crp-empty-state__text"},"Please select a role to configure pricing rules.")),(0,n.createElement)(L,{isOpen:E,title:"Delete Rule",message:"Are you sure you want to delete this rule? This action cannot be undone.",onConfirm:async()=>{if(h)try{await g(h.id),_(!1)}catch(e){console.error("Failed to delete rule:",e)}},onCancel:()=>_(!1),isDangerous:!0}))},D=({ruleId:e,categoryName:t,formData:a,onChange:l,onSelect:r,isSelected:o,hasChanges:c})=>(0,n.createElement)("tr",{className:`${o?"selected-row":""} ${c?"has-changes":""}`},(0,n.createElement)("td",{style:{width:"40px",textAlign:"center"}},(0,n.createElement)(d.CheckboxControl,{checked:o,onChange:t=>r(e,t),__nextHasNoMarginBottom:!0})),(0,n.createElement)("td",{style:{minWidth:"150px"}},(0,n.createElement)("strong",null,t),c&&(0,n.createElement)("div",{style:{fontSize:"11px",color:"#d63638",marginTop:"4px"}},"● Unsaved changes")),(0,n.createElement)("td",{style:{minWidth:"150px"}},(0,n.createElement)(d.SelectControl,{value:a.rule_type,options:q,onChange:t=>l(e,"rule_type",t),__nextHasNoMarginBottom:!0})),(0,n.createElement)("td",{style:{minWidth:"100px"}},(0,n.createElement)(d.TextControl,{value:a.rule_value,onChange:t=>l(e,"rule_value",t),placeholder:"0",type:"text",__nextHasNoMarginBottom:!0})),(0,n.createElement)("td",{style:{minWidth:"100px"}},(0,n.createElement)(d.TextControl,{value:a.category_value,onChange:t=>l(e,"category_value",t),placeholder:"0",type:"text",__nextHasNoMarginBottom:!0})),(0,n.createElement)("td",{style:{minWidth:"100px"}},(0,n.createElement)(d.TextControl,{value:String(a.min_quantity),onChange:t=>l(e,"min_quantity",parseInt(t)||0),placeholder:"0",type:"number",__nextHasNoMarginBottom:!0})),(0,n.createElement)("td",{style:{minWidth:"150px"}},(0,n.createElement)(d.SelectControl,{value:a.qty_rule_type,options:q,onChange:t=>l(e,"qty_rule_type",t),__nextHasNoMarginBottom:!0})),(0,n.createElement)("td",{style:{minWidth:"100px"}},(0,n.createElement)(d.TextControl,{value:a.qty_rule_value,onChange:t=>l(e,"qty_rule_value",t),placeholder:"0",type:"text",__nextHasNoMarginBottom:!0}))),A=({rules:e,categories:t,isLoading:a,roleFilter:l,onUpdate:o,onBulkUpdate:s,onBulkDelete:i,onRefetch:u})=>{const[m,p]=(0,r.useState)([]),[g,y]=(0,r.useState)(""),[h,E]=(0,r.useState)(""),[_,v]=(0,r.useState)(""),[f,b]=(0,r.useState)(!1),[C,w]=(0,r.useState)(new Map),[x,S]=(0,r.useState)(new Set),[k,R]=(0,r.useState)(!1);(0,r.useEffect)(()=>{const t=new Map;e.forEach(e=>{if(C.has(e.id))t.set(e.id,C.get(e.id));else{const a=e.single_categories?.[0];t.set(e.id,{rule_type:a?.rule?.type||"",rule_value:a?.rule?.value||"",category_value:"",min_quantity:a?.min_qty||0,qty_rule_type:a?.rule?.quantity_type||"",qty_rule_value:a?.rule?.quantity||""})}}),w(t)},[e]);const N=(e,t,a)=>{const l=C.get(e);if(!l)return;const r={...l,[t]:a},n=new Map(C);n.set(e,r),w(n);const o=new Set(x);o.add(e),S(o)},B=(0,r.useMemo)(()=>g?e.filter(e=>{const a=e.single_categories||[];return t.filter(e=>a.includes(e.id)&&e.name.toLowerCase().includes(g.toLowerCase())).length>0}):e,[e,g,t]),T=(e,t)=>{p(t?[...m,e]:m.filter(t=>t!==e))},P=e=>{const t=e.single_categories||[];return 0===t.length?"No categories":t.map(e=>e.name||e.slug||"Unknown").join(", ")||"Unknown"};return a?(0,n.createElement)("div",{style:{display:"flex",justifyContent:"center",padding:"40px"}},(0,n.createElement)(d.Spinner,null)):(0,n.createElement)(n.Fragment,null,(0,n.createElement)("div",{style:{marginBottom:"16px",display:"flex",gap:"10px",alignItems:"flex-end",flexWrap:"wrap"}},(0,n.createElement)("div",{style:{flex:"1",minWidth:"200px"}},(0,n.createElement)(d.TextControl,{label:"Search Categories",value:g,onChange:y,placeholder:"Filter by category name..."})),m.length>0&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)("div",{style:{minWidth:"150px"}},(0,n.createElement)(d.SelectControl,{label:"Bulk Rule Type",value:h,options:q,onChange:E})),(0,n.createElement)(d.Button,{variant:"secondary",onClick:async()=>{0!==m.length&&h&&(await s(m,{rule_type:h}),E(""))},disabled:!h},"Apply Type"),(0,n.createElement)("div",{style:{minWidth:"100px"}},(0,n.createElement)(d.TextControl,{label:"Bulk Value",value:_,onChange:v,placeholder:"e.g., 10"})),(0,n.createElement)(d.Button,{variant:"secondary",onClick:async()=>{0!==m.length&&_&&(await s(m,{rule_value:_}),v(""))},disabled:!_},"Apply Value"),(0,n.createElement)(d.Button,{variant:"secondary",isDestructive:!0,onClick:()=>b(!0)},"Delete (",m.length,")"))),x.size>0&&(0,n.createElement)("div",{className:"crp-save-banner"},(0,n.createElement)("span",{className:"crp-save-banner__message"},(0,n.createElement)("strong",null,x.size)," unsaved change",1!==x.size?"s":""),(0,n.createElement)("div",{className:"crp-save-banner__actions"},(0,n.createElement)(d.Button,{variant:"secondary",onClick:()=>window.location.reload(),disabled:k},"Discard Changes"),(0,n.createElement)(d.Button,{variant:"primary",onClick:async()=>{if(0!==x.size){R(!0);try{for(const t of Array.from(x)){const a=e.find(e=>e.id===t);if(!a)continue;const l=a.single_categories?.map(e=>{const a=C.get(t);return{category_id:e.id,type:a?.rule_type||e.rule?.type||"percentage",value:a?.rule_value||e.rule?.value||"0",min_qty:a?.min_quantity||e.min_qty||0,quantity:a?.qty_rule_value||e.rule?.quantity||"",quantity_type:a?.qty_rule_type||e.rule?.quantity_type||""}})||[];await c()({path:`/rrb2b/v1/rules/${t}/categories`,method:"PUT",data:{rows:l}})}S(new Set),u&&u()}catch(e){console.error("Failed to save changes:",e)}finally{R(!1)}}},isBusy:k,disabled:k},"Save All Changes"))),0===B.length?(0,n.createElement)("div",{style:{padding:"40px",textAlign:"center",background:"#f9f9f9",borderRadius:"4px"}},(0,n.createElement)("p",{style:{margin:0,color:"#757575"}},g?"No categories match your search.":"No category rules found.")):(0,n.createElement)("div",{style:{overflowX:"auto"}},(0,n.createElement)("table",{className:"wp-list-table widefat fixed striped",style:{minWidth:"1200px"}},(0,n.createElement)("thead",null,(0,n.createElement)("tr",null,(0,n.createElement)("th",{style:{width:"40px"}},(0,n.createElement)("input",{type:"checkbox",checked:m.length===B.length&&B.length>0,onChange:()=>{m.length===B.length?p([]):p(B.map(e=>e.id))}})),(0,n.createElement)("th",null,"Category"),(0,n.createElement)("th",null,"Rule Type"),(0,n.createElement)("th",null,"Value"),(0,n.createElement)("th",null,"Cat. Value"),(0,n.createElement)("th",null,"Min Qty"),(0,n.createElement)("th",null,"Qty Rule Type"),(0,n.createElement)("th",null,"Qty Value"),(0,n.createElement)("th",null,"Actions"))),(0,n.createElement)("tbody",null,B.map(e=>{const t=C.get(e.id)||{rule_type:"",rule_value:"",category_value:"",min_quantity:0,qty_rule_type:"",qty_rule_value:""};return(0,n.createElement)(D,{key:e.id,ruleId:e.id,categoryName:P(e),formData:t,onChange:N,onSelect:T,isSelected:m.includes(e.id),hasChanges:x.has(e.id)})})))),(0,n.createElement)(L,{isOpen:f,title:"Delete Selected Rules",message:`Are you sure you want to delete ${m.length} selected rule(s)? This action cannot be undone.`,onConfirm:async()=>{0!==m.length&&(await i(m),p([]),b(!1))},onCancel:()=>b(!1),isDangerous:!0}))},U=({roleFilter:e})=>{const[t,a]=(0,r.useState)(""),[l,o]=(0,r.useState)(!1),[s,i]=(0,r.useState)([]),[m,p]=(0,r.useState)(!1),g=e||t,{roles:y,isLoading:h}=u(),{categories:E,isLoading:_}=T(),{rules:v,isLoading:f,createRule:b,updateRule:C,bulkUpdate:w,bulkDelete:x,refetch:S}=N(g),k=v.filter(e=>e.single_categories&&e.single_categories.length>0);return(0,n.createElement)("div",{className:"crp-categories-tab"},!e&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)("div",{style:{marginBottom:"20px"}},(0,n.createElement)("h2",null,"Category Pricing Rules"),(0,n.createElement)("p",null,"Configure role-based pricing rules for specific product categories.")),(0,n.createElement)("div",{style:{marginBottom:"20px"}},(0,n.createElement)(B,{value:g,onChange:a,roles:y,label:"Filter by Role",disabled:h}))),(0,n.createElement)("div",{style:{marginBottom:"20px"}},(0,n.createElement)(d.Button,{variant:"secondary",onClick:()=>o(!l),disabled:!g&&!e},l?"Cancel":"+ Add Category Rules")),l&&(0,n.createElement)(d.Card,{style:{marginBottom:"20px"}},(0,n.createElement)(d.CardBody,null,(0,n.createElement)("h3",null,"Add Category Rules"),(0,n.createElement)(P,{value:s,onChange:i}),(0,n.createElement)("div",{style:{marginTop:"15px",display:"flex",gap:"10px"}},(0,n.createElement)(d.Button,{variant:"primary",onClick:async()=>{if(g&&0!==s.length){p(!0);try{const e=v.find(e=>e.role_name===g);if(e){const t=[...(e.single_categories||[]).map(e=>({category_id:e.id,type:e.rule?.type||"percentage",value:e.rule?.value||"0",min_qty:e.min_qty||0})),...s.map(e=>({category_id:e,type:"percentage",value:"0",min_qty:0}))];await c()({path:`/rrb2b/v1/rules/${e.id}/categories`,method:"PUT",data:{rows:t}}),S()}else await b({role:g,rule_type:"percentage",rule_value:"0",active:!0,single_categories:s});i([]),o(!1)}catch(e){console.error("Failed to add category rules:",e)}finally{p(!1)}}},isBusy:m,disabled:0===s.length||m},"Add Selected Categories"),(0,n.createElement)(d.Button,{variant:"tertiary",onClick:()=>o(!1)},"Cancel")),(0,n.createElement)("p",{style:{marginTop:"10px",fontSize:"13px",color:"#757575"}},"Select categories and configure pricing rules in the table below."))),(0,n.createElement)(A,{rules:k,categories:E,isLoading:f||_,roleFilter:g,onUpdate:C,onBulkUpdate:w,onBulkDelete:x,onRefetch:S}))},M=({ruleId:e,product:t,formData:a,onChange:l,onSelect:r,isSelected:o,hasChanges:c})=>{const s=["crp-product-row",o&&"selected-row",c&&"has-changes"].filter(Boolean).join(" ");return(0,n.createElement)("tr",{className:s},(0,n.createElement)("td",{className:"crp-table__checkbox-cell"},(0,n.createElement)(d.CheckboxControl,{checked:o,onChange:t=>r(e,t),__nextHasNoMarginBottom:!0})),(0,n.createElement)("td",{className:"crp-product-row__thumbnail-cell"},t?.thumbnail&&(0,n.createElement)("img",{src:t.thumbnail,alt:t.name,className:"crp-product-row__thumbnail"})),(0,n.createElement)("td",{className:"crp-product-row__name-cell"},(0,n.createElement)("strong",null,t?.name||"Unknown Product"),t?.sku&&(0,n.createElement)("div",{className:"crp-product-row__sku"},"SKU: ",t.sku),c&&(0,n.createElement)("div",{className:"crp-product-row__unsaved-indicator"},"● Unsaved changes")),(0,n.createElement)("td",null,(0,n.createElement)(d.SelectControl,{value:a.rule_type,options:q,onChange:t=>l(e,"rule_type",t),__nextHasNoMarginBottom:!0})),(0,n.createElement)("td",null,(0,n.createElement)(d.TextControl,{value:a.rule_value,onChange:t=>l(e,"rule_value",t),placeholder:"0",type:"text",__nextHasNoMarginBottom:!0})),(0,n.createElement)("td",null,(0,n.createElement)(d.TextControl,{value:String(a.min_quantity),onChange:t=>l(e,"min_quantity",parseInt(t)||0),placeholder:"0",type:"number",__nextHasNoMarginBottom:!0})),(0,n.createElement)("td",null,(0,n.createElement)(d.SelectControl,{value:a.qty_rule_type,options:q,onChange:t=>l(e,"qty_rule_type",t),__nextHasNoMarginBottom:!0})),(0,n.createElement)("td",null,(0,n.createElement)(d.TextControl,{value:a.qty_rule_value,onChange:t=>l(e,"qty_rule_value",t),placeholder:"0",type:"text",__nextHasNoMarginBottom:!0})))},$=({rules:e,products:t,isLoading:a,roleFilter:l,onUpdate:o,onBulkUpdate:s,onBulkDelete:i,onAddProduct:u,onRefetch:m})=>{const[p,g]=(0,r.useState)([]),[y,h]=(0,r.useState)(""),[E,_]=(0,r.useState)(""),[v,f]=(0,r.useState)(""),[b,C]=(0,r.useState)(!1),[w,x]=(0,r.useState)(new Map),[S,k]=(0,r.useState)(new Set),[R,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{const t=new Map;e.forEach(e=>{if(w.has(e.id))t.set(e.id,w.get(e.id));else{const a=e.products?.[0];t.set(e.id,{rule_type:a?.rule?.type||"",rule_value:a?.rule?.value||"",min_quantity:a?.min_qty||0,qty_rule_type:a?.rule?.quantity_type||"",qty_rule_value:a?.rule?.quantity||""})}}),x(t)},[e]);const B=(0,r.useMemo)(()=>y?e.filter(e=>(e.products||[]).some(e=>{const a=y.toLowerCase();if(e.name&&e.name.toLowerCase().includes(a))return!0;const l=t.get(e.id);return!(!l?.sku||!l.sku.toLowerCase().includes(a))})):e,[e,y,t]),T=(e,t)=>{g(t?[...p,e]:p.filter(t=>t!==e))},P=(e,t,a)=>{const l=w.get(e);if(!l)return;const r={...l,[t]:a},n=new Map(w);n.set(e,r),x(n);const o=new Set(S);o.add(e),k(o)};return a?(0,n.createElement)("div",{style:{display:"flex",justifyContent:"center",padding:"40px"}},(0,n.createElement)(d.Spinner,null)):(0,n.createElement)(n.Fragment,null,(0,n.createElement)("div",{style:{marginBottom:"16px"}},(0,n.createElement)("div",{style:{maxWidth:"300px"}},(0,n.createElement)(d.TextControl,{label:"Filter Existing Rules",value:y,onChange:h,placeholder:"Filter by product name or SKU...",help:"Search within the table below"}))),p.length>0&&(0,n.createElement)("div",{style:{marginBottom:"16px"}},(0,n.createElement)("div",{style:{display:"flex",gap:"10px",alignItems:"flex-end",flexWrap:"wrap"}},(0,n.createElement)("div",{style:{minWidth:"150px"}},(0,n.createElement)(d.SelectControl,{label:"Bulk Rule Type",value:E,options:q,onChange:_})),(0,n.createElement)(d.Button,{variant:"secondary",onClick:async()=>{0!==p.length&&E&&(await s(p,{rule_type:E}),_(""))},disabled:!E},"Apply Type"),(0,n.createElement)("div",{style:{minWidth:"100px"}},(0,n.createElement)(d.TextControl,{label:"Bulk Value",value:v,onChange:f,placeholder:"e.g., 10"})),(0,n.createElement)(d.Button,{variant:"secondary",onClick:async()=>{0!==p.length&&v&&(await s(p,{rule_value:v}),f(""))},disabled:!v},"Apply Value"),(0,n.createElement)(d.Button,{variant:"secondary",isDestructive:!0,onClick:()=>C(!0)},"Delete (",p.length,")"))),S.size>0&&(0,n.createElement)("div",{className:"crp-save-banner"},(0,n.createElement)("span",{className:"crp-save-banner__message"},(0,n.createElement)("strong",null,S.size)," unsaved change",1!==S.size?"s":""),(0,n.createElement)("div",{className:"crp-save-banner__actions"},(0,n.createElement)(d.Button,{variant:"secondary",onClick:()=>window.location.reload(),disabled:R},"Discard Changes"),(0,n.createElement)(d.Button,{variant:"primary",onClick:async()=>{if(0!==S.size){N(!0);try{for(const t of Array.from(S)){const a=e.find(e=>e.id===t);if(!a)continue;const l=a.products?.map(e=>{const a=w.get(t);return{product_id:e.id,product_name:e.name,type:a?.rule_type||e.rule?.type||"percentage",value:a?.rule_value||e.rule?.value||"0",min_qty:a?.min_quantity||e.min_qty||1,quantity:a?.qty_rule_value||e.rule?.quantity||"",quantity_type:a?.qty_rule_type||e.rule?.quantity_type||""}})||[];await c()({path:`/rrb2b/v1/rules/${t}/products`,method:"PUT",data:{rows:l}})}k(new Set),m&&m()}catch(e){console.error("Failed to save changes:",e)}finally{N(!1)}}},isBusy:R,disabled:R},"Save All Changes"))),0===B.length?(0,n.createElement)("div",{className:"crp-empty-state"},(0,n.createElement)("p",{className:"crp-empty-state__text"},y?"No products match your search.":"No product rules found. Add products using the search above.")):(0,n.createElement)("div",{className:"crp-table-container"},(0,n.createElement)("table",{className:"wp-list-table widefat fixed striped crp-table"},(0,n.createElement)("thead",null,(0,n.createElement)("tr",null,(0,n.createElement)("th",{style:{width:"40px"}},(0,n.createElement)("input",{type:"checkbox",checked:p.length===B.length&&B.length>0,onChange:()=>{p.length===B.length?g([]):g(B.map(e=>e.id))}})),(0,n.createElement)("th",{style:{width:"60px"}},"Image"),(0,n.createElement)("th",null,"Product"),(0,n.createElement)("th",null,"Rule Type"),(0,n.createElement)("th",null,"Value"),(0,n.createElement)("th",null,"Minimum Quantity"),(0,n.createElement)("th",null,"Quantity Rule Type"),(0,n.createElement)("th",null,"Quantity Value"))),(0,n.createElement)("tbody",null,B.map(e=>{const a=e.products?.[0],l=a?{id:a.id,name:a.name,sku:"",thumbnail:t.get(a.id)?.thumbnail||""}:null,r=w.get(e.id)||{rule_type:"",rule_value:"",min_quantity:0,qty_rule_type:"",qty_rule_value:""};return(0,n.createElement)(M,{key:e.id,ruleId:e.id,product:l,formData:r,onChange:P,onSelect:T,isSelected:p.includes(e.id),hasChanges:S.has(e.id)})})))),(0,n.createElement)(L,{isOpen:b,title:"Delete Selected Rules",message:`Are you sure you want to delete ${p.length} selected rule(s)? This action cannot be undone.`,onConfirm:async()=>{0!==p.length&&(await i(p),g([]),C(!1))},onCancel:()=>C(!1),isDangerous:!0}))},O=window.wp.compose,I=({onSelect:e,ruleId:t,placeholder:a="Search products..."})=>{const[l,o]=(0,r.useState)(""),[s,i]=(0,r.useState)([]),[u,m]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),{searchProducts:y}=(()=>{const[e,t]=(0,r.useState)(!1);return{searchProducts:async(e,a)=>{if(!e||e.length<2)return[];t(!0);try{return a?await c()({path:`/rrb2b/v1/rules/${a}/products/search`,method:"POST",data:{search:e}}):(await c()({path:`/wc/v3/products?search=${encodeURIComponent(e)}&per_page=20`})).map(e=>({id:e.id,name:e.name,sku:e.sku,price:e.price,thumbnail:e.images?.[0]?.src||""}))}catch(e){return console.error("Error searching products:",e),[]}finally{t(!1)}},getProductsByCategory:async e=>{t(!0);try{return(await c()({path:`/wc/v3/products?category=${e}&per_page=100`})).map(e=>({id:e.id,name:e.name,sku:e.sku,price:e.price,thumbnail:e.images?.[0]?.src||""}))}catch(e){return console.error("Error fetching products by category:",e),[]}finally{t(!1)}},isSearching:e}})(),h=(0,r.useMemo)(()=>(0,O.debounce)(async e=>{if(e.length<2)return i([]),void g(!1);g(!0);const a=await y(e,t);i(a),m(!0),g(!1)},300),[t,y]);return(0,r.useEffect)(()=>{l.length>=2&&g(!0),h(l)},[l,h]),(0,n.createElement)("div",{className:"crp-product-search"},(0,n.createElement)(d.TextControl,{label:"Search Products",value:l,onChange:o,placeholder:a,autoComplete:"off"}),p&&(0,n.createElement)("div",{className:"crp-product-search__spinner"},(0,n.createElement)(d.Spinner,null)),u&&s.length>0&&(0,n.createElement)("div",{className:"crp-product-search__results"},s.map(t=>(0,n.createElement)("button",{key:t.id,onClick:()=>(t=>{e(t),o(""),i([]),m(!1)})(t),className:"crp-product-search__result-item"},t.thumbnail&&(0,n.createElement)("img",{src:t.thumbnail,alt:t.name,className:"crp-product-search__result-thumbnail"}),(0,n.createElement)("div",{className:"crp-product-search__result-details"},(0,n.createElement)("div",{className:"crp-product-search__result-name"},t.name),t.sku&&(0,n.createElement)("div",{className:"crp-product-search__result-sku"},"SKU: ",t.sku)),t.price&&(0,n.createElement)("div",{className:"crp-product-search__result-price"},"$",t.price)))),l.length>=2&&0===s.length&&!p&&(0,n.createElement)("div",{className:"crp-product-search__no-results"},"No products found"))},W=({isOpen:e,onClose:t,onAddProduct:a,onAddFromCategory:l,categories:o})=>{const[s,i]=(0,r.useState)([]),[u,m]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),[y,h]=(0,r.useState)([]),[E,_]=(0,r.useState)(!1);(0,r.useEffect)(()=>{e&&0===y.length&&v()},[e]);const v=async()=>{_(!0);try{const e=(await c()({path:"/wc/v3/products?per_page=10&orderby=popularity&order=desc"})).map(e=>({id:e.id,name:e.name,sku:e.sku,price:e.price,thumbnail:e.images?.[0]?.src||""}));h(e)}catch(e){console.error("Failed to load suggested products:",e)}finally{_(!1)}},f=async()=>{if(0!==s.length){g(!0);try{await l(s,u),i([]),m(!1),t()}catch(e){console.error("Failed to add products from category:",e)}finally{g(!1)}}},b=async e=>{g(!0);try{await a(e),t()}catch(e){console.error("Failed to add product:",e)}finally{g(!1)}};return e?(0,n.createElement)(d.Modal,{title:"Add Product Rules",onRequestClose:t,className:"crp-add-product-modal"},(0,n.createElement)(d.TabPanel,{className:"crp-add-product-tabs",tabs:[{name:"search",title:"Add Products"},{name:"category",title:"Add from Category"}]},e=>"search"===e.name?(0,n.createElement)("div",{className:"crp-add-product-tabs"},(0,n.createElement)("p",{className:"crp-modal__description"},"Search and select products to add pricing rules."),(0,n.createElement)(I,{onSelect:b,placeholder:"Search for products..."}),E?(0,n.createElement)("div",{style:{padding:"20px",textAlign:"center"}},(0,n.createElement)(d.Spinner,null),(0,n.createElement)("p",null,"Loading suggested products...")):y.length>0&&(0,n.createElement)("div",{style:{marginTop:"20px"}},(0,n.createElement)("h4",null,"Suggested Products"),(0,n.createElement)("div",{style:{display:"grid",gap:"8px"}},y.map(e=>(0,n.createElement)("button",{key:e.id,onClick:()=>b(e),className:"crp-product-search__result-item",style:{border:"1px solid #ddd",borderRadius:"4px"}},e.thumbnail&&(0,n.createElement)("img",{src:e.thumbnail,alt:e.name,className:"crp-product-search__result-thumbnail"}),(0,n.createElement)("div",{className:"crp-product-search__result-details"},(0,n.createElement)("div",{className:"crp-product-search__result-name"},e.name),e.sku&&(0,n.createElement)("div",{className:"crp-product-search__result-sku"},"SKU: ",e.sku)),e.price&&(0,n.createElement)("div",{className:"crp-product-search__result-price"},"$",e.price)))))):(0,n.createElement)("div",{className:"crp-add-product-tabs"},(0,n.createElement)("p",{className:"crp-modal__description"},"Select categories to add all products from those categories."),o.length>0&&(0,n.createElement)("div",{style:{marginBottom:"15px"}},(0,n.createElement)("h4",null,"Suggested Categories"),(0,n.createElement)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"}},o.slice(0,6).map(e=>(0,n.createElement)(d.Button,{key:e.id,variant:"secondary",size:"small",onClick:()=>{s.includes(e.id)||i([...s,e.id])},disabled:s.includes(e.id)},e.name)))),(0,n.createElement)(P,{value:s,onChange:i}),(0,n.createElement)("div",{className:"crp-modal__checkbox-label"},(0,n.createElement)("label",null,(0,n.createElement)("input",{type:"checkbox",checked:u,onChange:e=>m(e.target.checked),className:"crp-modal__checkbox-input"}),"Include product variations")),(0,n.createElement)("div",{className:"crp-modal__actions"},(0,n.createElement)(d.Button,{variant:"primary",onClick:f,isBusy:p,disabled:0===s.length||p},"Add Products from Categories"),(0,n.createElement)(d.Button,{variant:"tertiary",onClick:t,disabled:p},"Cancel"))))):null},z=({roleFilter:e})=>{const[t,a]=(0,r.useState)(""),[l,o]=(0,r.useState)(!1),s=e||t,{roles:i,isLoading:m}=u(),{categories:p,isLoading:g}=T(),{rules:y,isLoading:h,createRule:E,updateRule:_,bulkUpdate:v,bulkDelete:f,refetch:b}=N(s),[C,w]=(0,r.useState)(new Map),x=y.filter(e=>e.products&&e.products.length>0);(0,r.useEffect)(()=>{x.length>0&&(async()=>{const e=new Set;x.forEach(t=>{t.products?.forEach(t=>e.add(t.id))});const t=new Map(C),a=Array.from(e).filter(e=>!t.has(e));if(a.length>0)try{for(let e=0;e<a.length;e+=20){const l=a.slice(e,e+20);(await c()({path:`/wc/v3/products?include=${l.join(",")}`})).forEach(e=>{t.set(e.id,{id:e.id,name:e.name,sku:e.sku,price:e.price,thumbnail:e.images?.[0]?.src||""})})}w(t)}catch(e){console.error("Failed to fetch products:",e)}})()},[x.length]);const S=async e=>{if(!s)throw new Error("Please select a role first");const t=y.find(e=>e.role_name===s);if(t){const a=[...(t.products||[]).map(e=>({product_id:e.id,product_name:e.name||"",type:e.rule?.type||"percentage",value:e.rule?.value||"0",min_qty:e.min_qty||1})),{product_id:e.id,product_name:e.name,type:"percentage",value:"0",min_qty:1}];await c()({path:`/rrb2b/v1/rules/${t.id}/products`,method:"PUT",data:{rows:a}}),b()}else await E({role:s,rule_type:"percentage",rule_value:"0",active:!0,products:[e.id],productDetails:[{id:e.id,name:e.name}]});w(t=>new Map(t).set(e.id,e))};return(0,n.createElement)("div",{className:"crp-products-tab"},!e&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)("div",{style:{marginBottom:"20px"}},(0,n.createElement)("h2",null,"Product Pricing Rules"),(0,n.createElement)("p",null,"Configure role-based pricing rules for specific products.")),(0,n.createElement)("div",{style:{marginBottom:"20px"}},(0,n.createElement)(B,{value:s,onChange:a,roles:i,label:"Filter by Role",disabled:m}))),(0,n.createElement)("div",{style:{marginBottom:"20px"}},(0,n.createElement)(d.Button,{variant:"secondary",onClick:()=>o(!0),disabled:!s&&!e},"+ Add Product Rules")),(0,n.createElement)(W,{isOpen:l,onClose:()=>o(!1),onAddProduct:S,onAddFromCategory:async(e,t)=>{if(!s)throw new Error("Please select a role first");const a=y.find(e=>e.role_name===s);if(!a)throw new Error("Please create a rule for this role first");await c()({path:`/rrb2b/v1/rules/${a.id}/products/from-category`,method:"POST",data:{category:e[0],variations:t}}),b()},categories:p}),(0,n.createElement)($,{rules:x,products:C,isLoading:h,roleFilter:s,onUpdate:_,onBulkUpdate:v,onBulkDelete:f,onAddProduct:S,onRefetch:b}))},H=({role:e,onBack:t})=>(0,n.createElement)("div",{className:"crp-rules-detail-view",style:{marginTop:"20px"}},(0,n.createElement)("div",{style:{marginBottom:"20px",display:"flex",alignItems:"center",gap:"15px"}},(0,n.createElement)(d.Button,{variant:"secondary",onClick:t,icon:"arrow-left-alt2"},"Back to Roles"),(0,n.createElement)("div",null,(0,n.createElement)("h2",{style:{margin:0}},"Pricing Rules for: ",e.name),(0,n.createElement)("p",{style:{margin:"5px 0 0 0",color:"#666",fontSize:"13px"}},"Role: ",e.slug))),(0,n.createElement)(d.TabPanel,{className:"crp-rules-tabs",activeClass:"is-active",tabs:[{name:"general",title:"General Rules",className:"tab-general-rules"},{name:"categories",title:"Categories",className:"tab-categories"},{name:"products",title:"Products",className:"tab-products"}]},t=>{switch(t.name){case"general":return(0,n.createElement)(F,{roleFilter:e.slug});case"categories":return(0,n.createElement)(U,{roleFilter:e.slug});case"products":return(0,n.createElement)(z,{roleFilter:e.slug});default:return null}})),j=()=>{const e=new URLSearchParams(window.location.search).get("role"),[t,a]=(0,r.useState)(e),{roles:l,isLoading:o}=u();(0,r.useEffect)(()=>{e&&e!==t&&a(e)},[e]);const c=t?l.find(e=>e.slug===t):null;return c?(0,n.createElement)(H,{role:c,onBack:()=>{a(null);const e=new URL(window.location.href);e.searchParams.delete("role"),window.history.pushState({},"",e.toString())}}):(0,n.createElement)(m,{roles:l,isLoading:o,onSelectRole:e=>{a(e);const t=new URL(window.location.href);t.searchParams.set("role",e),window.history.pushState({},"",t.toString())}})};class V extends r.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("React Error:",e,t)}render(){return this.state.hasError?(0,n.createElement)("div",{className:"notice notice-error",style:{padding:"20px",margin:"20px 0"}},(0,n.createElement)("h3",null,"Something went wrong"),(0,n.createElement)("p",null,"The admin interface encountered an error. Please refresh the page to try again."),this.state.error&&(0,n.createElement)("details",{style:{marginTop:"10px"}},(0,n.createElement)("summary",null,"Error details"),(0,n.createElement)("pre",{style:{marginTop:"10px",padding:"10px",background:"#f5f5f5",overflow:"auto"}},this.state.error.toString()))):this.props.children}}const G=V,Q=()=>{const e=document.getElementById("rrb2b-rules-root");e&&(0,r.createRoot)(e).render((0,r.createElement)(G,null,(0,r.createElement)(j)))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Q):Q()})();
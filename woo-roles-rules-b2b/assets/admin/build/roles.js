(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var l in r)e.o(r,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:r[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,r=window.React,l=window.wp.apiFetch;var o=e.n(l);const a=window.wp.data,n=window.wp.notices,s=window.wp.components,c=({onCreate:e,allRoles:l=[],cloneFrom:o})=>{const[a,n]=(0,t.useState)(""),[c,i]=(0,t.useState)(""),[u,m]=(0,t.useState)(o||"customer"),[d,h]=(0,t.useState)(!1);(0,t.useEffect)(()=>{if(o){m(o);const e=l.find(e=>e.slug===o);e&&(n(`${e.name} (Copy)`),i(p(`${e.name}_copy`)))}},[o,l]);const p=e=>e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,""),E=["administrator","editor","author","contributor","subscriber","customer","shop_manager"],g=[{label:"--- WordPress & WooCommerce Defaults ---",value:"",disabled:!0},{label:"Customer (WooCommerce)",value:"customer"},{label:"Shop Manager (WooCommerce)",value:"shop_manager"},{label:"Subscriber",value:"subscriber"},{label:"Contributor",value:"contributor"},{label:"Author",value:"author"},{label:"Editor",value:"editor"}],y=l.filter(e=>!E.includes(e.slug));return y.length>0&&(g.push({label:"--- Custom Roles ---",value:"",disabled:!0}),y.forEach(e=>{g.push({label:e.name,value:e.slug,disabled:!1})})),(0,r.createElement)(s.Card,null,(0,r.createElement)(s.CardBody,null,(0,r.createElement)("h3",null,o?"Clone Role":"Create New Role"),(0,r.createElement)("form",{onSubmit:async t=>{if(t.preventDefault(),a.trim()&&c.trim()){h(!0);try{await e({name:a,slug:c,baseCap:u}),n(""),i(""),m("customer")}catch(e){console.error("Error creating role:",e)}finally{h(!1)}}}},(0,r.createElement)(s.TextControl,{label:"Role Name",value:a,onChange:e=>{n(e),c&&c!==p(a)||i(p(e))},placeholder:"e.g. Wholesale Customer",required:!0}),(0,r.createElement)(s.TextControl,{label:"Role Slug",value:c,onChange:i,placeholder:"e.g. wholesale_customer",help:"Used internally. Only lowercase letters, numbers, and underscores.",required:!0}),(0,r.createElement)(s.SelectControl,{label:"Base Capabilities (Clone From)",value:u,onChange:m,options:g,help:"The new role will inherit all capabilities from this role."}),(0,r.createElement)(s.Button,{variant:"primary",type:"submit",isBusy:d,disabled:d||!a.trim()||!c.trim()},o?"Create Cloned Role":"Create Role"))))},i=({roles:e,isLoading:l,onCreateRole:o,onDeleteRole:a,onSelectRole:n,showCreateForm:i=!0,showDeleteButton:u=!0,showManageRulesButton:m=!0})=>{const[d,h]=(0,t.useState)(null),[p,E]=(0,t.useState)(null);return l?(0,r.createElement)("div",null,"Loading roles..."):(0,r.createElement)("div",{className:"crp-roles-list-view"},(0,r.createElement)("div",{style:{marginBottom:"20px"}},(0,r.createElement)("h2",null,"Role Management"),(0,r.createElement)("p",null,"Create, delete, and clone custom roles for your B2B customers.")),i&&o&&(0,r.createElement)("div",{style:{marginBottom:"30px"}},(0,r.createElement)(c,{onCreate:o,allRoles:e,cloneFrom:p||void 0}),p&&(0,r.createElement)(s.Button,{variant:"link",onClick:()=>E(null),style:{marginTop:"10px"}},"Cancel Clone")),(0,r.createElement)(s.Card,null,(0,r.createElement)(s.CardBody,null,(0,r.createElement)("h3",null,"All Roles"),(0,r.createElement)("table",{className:"wp-list-table widefat fixed striped"},(0,r.createElement)("thead",null,(0,r.createElement)("tr",null,(0,r.createElement)("th",{style:{width:"30%"}},"Role Name"),(0,r.createElement)("th",{style:{width:"20%"}},"Slug"),(0,r.createElement)("th",{style:{width:"15%"}},"Users"),(0,r.createElement)("th",{style:{width:"35%"}},"Actions"))),(0,r.createElement)("tbody",null,0===e.length?(0,r.createElement)("tr",null,(0,r.createElement)("td",{colSpan:4,style:{textAlign:"center",padding:"20px"}},i?"No roles found. Create your first role above.":"No roles found.")):e.map(e=>{var t;return(0,r.createElement)("tr",{key:e.slug},(0,r.createElement)("td",null,(0,r.createElement)("strong",null,e.name)),(0,r.createElement)("td",null,(0,r.createElement)("code",null,e.slug)),(0,r.createElement)("td",null,null!==(t=e.user_count)&&void 0!==t?t:0),(0,r.createElement)("td",null,m&&n&&(0,r.createElement)(s.Button,{variant:"primary",onClick:()=>n(e.slug),style:{marginRight:"8px"}},"Manage Rules"),i&&o&&(0,r.createElement)(s.Button,{variant:"secondary",onClick:()=>{return t=e.slug,E(t),void setTimeout(()=>{document.querySelector(".crp-roles-list-view")?.scrollIntoView({behavior:"smooth"})},100);var t},style:{marginRight:"8px"}},"Clone"),u&&a&&(0,r.createElement)(s.Button,{variant:"secondary",isDestructive:!0,onClick:()=>(async(e,t)=>{if(a&&confirm(`Are you sure you want to delete the role "${t}"? This will also delete all associated rules.`)){h(e);try{await a(e)}finally{h(null)}}})(e.slug,e.name),isBusy:d===e.slug,disabled:d===e.slug},"Delete")))}))))))},u=()=>{const{roles:e,isLoading:l,createRole:s,deleteRole:c}=(()=>{const[e,r]=(0,t.useState)([]),[l,s]=(0,t.useState)(!1),{createSuccessNotice:c,createErrorNotice:i}=(0,a.useDispatch)(n.store),u=async()=>{s(!0);try{const e=await o()({path:"/rrb2b/v1/roles",method:"GET"});r(e)}catch(e){const t=e instanceof Error?e.message:"Unknown error";i(`Failed to load roles: ${t}`),console.error("Error fetching roles:",e)}finally{s(!1)}};return(0,t.useEffect)(()=>{u()},[]),{roles:e,isLoading:l,createRole:async t=>{try{const l={role_name:t.name,role_slug:t.slug,role_cap:t.baseCap||"customer"},a=(await o()({path:"/rrb2b/v1/roles",method:"POST",data:l})).role;return r([...e,a]),c("Role created successfully!",{type:"snackbar"}),a}catch(e){const t=e instanceof Error?e.message:"Unknown error";throw i(`Failed to create role: ${t}`),e}},deleteRole:async t=>{const l=[...e];r(e.filter(e=>e.slug!==t));try{await o()({path:`/rrb2b/v1/roles/${t}`,method:"DELETE"}),c("Role deleted successfully!",{type:"snackbar"})}catch(e){r(l);const t=e instanceof Error?e.message:"Unknown error";throw i(`Failed to delete role: ${t}`),e}},refetch:u}})();return(0,r.createElement)(i,{roles:e,isLoading:l,onSelectRole:()=>{},showCreateForm:!0,showDeleteButton:!0,showManageRulesButton:!1,onCreateRole:s,onDeleteRole:c})};class m extends t.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("React Error:",e,t)}render(){return this.state.hasError?(0,r.createElement)("div",{className:"notice notice-error",style:{padding:"20px",margin:"20px 0"}},(0,r.createElement)("h3",null,"Something went wrong"),(0,r.createElement)("p",null,"The admin interface encountered an error. Please refresh the page to try again."),this.state.error&&(0,r.createElement)("details",{style:{marginTop:"10px"}},(0,r.createElement)("summary",null,"Error details"),(0,r.createElement)("pre",{style:{marginTop:"10px",padding:"10px",background:"#f5f5f5",overflow:"auto"}},this.state.error.toString()))):this.props.children}}const d=m,h=()=>{const e=document.getElementById("rrb2b-roles-root");e&&(0,t.createRoot)(e).render((0,t.createElement)(d,null,(0,t.createElement)(u)))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h()})();
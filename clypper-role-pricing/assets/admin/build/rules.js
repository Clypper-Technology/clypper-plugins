(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{addRule:()=>x,deleteRule:()=>m,setError:()=>v,setLoading:()=>j,setRules:()=>g,updateRule:()=>y});var r={};e.r(r),e.d(r,{getError:()=>w,getRuleById:()=>f,getRules:()=>_,getRulesByRole:()=>b,isLoading:()=>C});var s={};e.r(s),e.d(s,{getRules:()=>S});const a=window.wp.element,l=window.wp.apiFetch;var n=e.n(l);const i=window.wp.data,o=window.wp.notices,c=()=>{const[e,t]=(0,a.useState)([]),[r,s]=(0,a.useState)(!1),{createSuccessNotice:l,createErrorNotice:c}=(0,i.useDispatch)(o.store),d=async()=>{s(!0);try{const e=await n()({path:"/rrb2b/v1/roles",method:"GET"});t(e)}catch(e){const t=e instanceof Error?e.message:"Unknown error";c(`Failed to load roles: ${t}`),console.error("Error fetching roles:",e)}finally{s(!1)}};return(0,a.useEffect)(()=>{d()},[]),{roles:e,isLoading:r,createRole:async r=>{try{const s={role_name:r.name,role_slug:r.slug,role_cap:r.baseCap||"customer"},a=(await n()({path:"/rrb2b/v1/roles",method:"POST",data:s})).role;return t([...e,a]),l("Role created successfully!",{type:"snackbar"}),a}catch(e){const t=e instanceof Error?e.message:"Unknown error";throw c(`Failed to create role: ${t}`),e}},deleteRole:async r=>{const s=[...e];t(e.filter(e=>e.slug!==r));try{await n()({path:`/rrb2b/v1/roles/${r}`,method:"DELETE"}),l("Role deleted successfully!",{type:"snackbar"})}catch(e){t(s);const r=e instanceof Error?e.message:"Unknown error";throw c(`Failed to delete role: ${r}`),e}},refetch:d}},d=window.wp.components,u=window.ReactJSXRuntime,p=({roles:e,isLoading:t,onSelectRole:r})=>t?(0,u.jsxs)("div",{style:{padding:"20px",textAlign:"center"},children:[(0,u.jsx)(d.Spinner,{}),(0,u.jsx)("p",{children:"Loading roles..."})]}):(0,u.jsxs)("div",{className:"crp-rules-list-view",style:{marginTop:"20px"},children:[(0,u.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,u.jsx)("h2",{children:"Pricing Rules Management"}),(0,u.jsx)("p",{children:"Select a role to configure its pricing rules, discounts, and category-specific settings."})]}),(0,u.jsx)(d.Card,{children:(0,u.jsxs)(d.CardBody,{children:[(0,u.jsx)("h3",{children:"All Roles"}),(0,u.jsxs)("table",{className:"wp-list-table widefat fixed striped",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{style:{width:"35%"},children:"Role Name"}),(0,u.jsx)("th",{style:{width:"25%"},children:"Slug"}),(0,u.jsx)("th",{style:{width:"15%"},children:"Users"}),(0,u.jsx)("th",{style:{width:"25%"},children:"Actions"})]})}),(0,u.jsx)("tbody",{children:0===e.length?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:4,style:{textAlign:"center",padding:"20px"},children:'No roles found. Create roles in the "Manage Roles" tab first.'})}):e.map(e=>(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:(0,u.jsx)("strong",{children:e.name})}),(0,u.jsx)("td",{children:(0,u.jsx)("code",{children:e.slug})}),(0,u.jsx)("td",{children:e.user_count??0}),(0,u.jsx)("td",{children:(0,u.jsx)(d.Button,{variant:"primary",onClick:()=>r(e.slug),children:"Manage Pricing Rules →"})})]},e.slug))})]})]})})]}),h={rules:[],isLoading:!1,error:null},g=e=>({type:"SET_RULES",rules:e}),x=e=>({type:"ADD_RULE",rule:e}),y=e=>({type:"UPDATE_RULE",rule:e}),m=e=>({type:"DELETE_RULE",id:e}),j=e=>({type:"SET_LOADING",isLoading:e}),v=e=>({type:"SET_ERROR",error:e}),_=e=>e.rules,f=(e,t)=>e.rules.find(e=>e.id===t),b=(0,i.createSelector)([e=>e.rules,(e,t)=>t],(e,t)=>t?e.filter(e=>e.role_name===t):e),C=e=>e.isLoading,w=e=>e.error,S=()=>async({dispatch:e})=>{e(j(!0));try{const t=await n()({path:"/rrb2b/v1/rules"});e(g(t))}catch(t){const r=t instanceof Error?t.message:"Failed to load rules";e(v(r)),console.error("Error fetching rules:",t)}finally{e(j(!1))}},R="rrb2b/rules",k=(0,i.createReduxStore)(R,{reducer:(e=h,t)=>{switch(t.type){case"SET_RULES":return{...e,rules:t.rules,error:null};case"ADD_RULE":return{...e,rules:[...e.rules,t.rule]};case"UPDATE_RULE":return{...e,rules:e.rules.map(e=>e.id===t.rule.id?t.rule:e)};case"DELETE_RULE":return{...e,rules:e.rules.filter(e=>e.id!==t.id)};case"SET_LOADING":return{...e,isLoading:t.isLoading};case"SET_ERROR":return{...e,error:t.error};default:return e}},actions:t,selectors:r,resolvers:s});(0,i.register)(k);const N=e=>{const{rules:t,isLoading:r,error:s}=(0,i.useSelect)(t=>{const r=t(R).getRules();return{rules:e?t(R).getRulesByRole(e):r,isLoading:t(R).isLoading(),error:t(R).getError()}},[e]),{addRule:a,updateRule:l,deleteRule:c,invalidateResolution:d}=(0,i.useDispatch)(R),{createSuccessNotice:u,createErrorNotice:p}=(0,i.useDispatch)(o.store),h=async(e,r)=>{const s=t.find(t=>t.id===e);s&&l({...s,...r});try{const t=await n()({path:`/rrb2b/v1/rules/${e}`,method:"PUT",data:r});return l(t),u("Rule updated successfully!",{type:"snackbar"}),t}catch(e){s&&l(s);const t=e instanceof Error?e.message:"Failed to update rule";throw p(`Failed to update rule: ${t}`),e}},g=async e=>{c(e);try{await n()({path:`/rrb2b/v1/rules/${e}`,method:"DELETE"}),u("Rule deleted successfully!",{type:"snackbar"})}catch(e){const t=e instanceof Error?e.message:"Failed to delete rule";throw p(`Failed to delete rule: ${t}`),e}};return{rules:t,isLoading:r,error:s,createRule:async e=>{try{const t={role_name:e.role},r=await n()({path:"/rrb2b/v1/rules",method:"POST",data:t});(void 0!==e.active||e.rule_type||e.rule_value)&&await n()({path:`/rrb2b/v1/rules/${r.id}`,method:"PUT",data:{rule_active:e.active,global_rule:e.rule_type&&e.rule_value?{type:e.rule_type,value:e.rule_value}:void 0}});const s=await n()({path:`/rrb2b/v1/rules/${r.id}`,method:"GET"});return a(s),u("Rule created successfully!",{type:"snackbar"}),s}catch(e){const t=e instanceof Error?e.message:"Failed to create rule";throw p(`Failed to create rule: ${t}`),e}},updateRule:h,deleteRule:g,toggleActive:async e=>{const r=t.find(t=>t.id===e);r&&await h(e,{rule_active:!r.rule_active})},copyRule:async(e,t)=>{try{(await n()({path:`/rrb2b/v1/rules/${e}/copy`,method:"POST",data:{destination_roles:t}})).forEach(e=>a(e)),u(`Rule copied to ${t.length} role(s) successfully!`,{type:"snackbar"})}catch(e){const t=e instanceof Error?e.message:"Failed to copy rule";throw p(`Failed to copy rule: ${t}`),e}},bulkUpdate:async(e,t)=>{try{const r=e.map(e=>h(e,t));await Promise.all(r),u(`${e.length} rule(s) updated successfully!`,{type:"snackbar"})}catch(e){const t=e instanceof Error?e.message:"Failed to bulk update";throw p(`Bulk update failed: ${t}`),e}},bulkDelete:async e=>{try{const t=e.map(e=>g(e));await Promise.all(t),u(`${e.length} rule(s) deleted successfully!`,{type:"snackbar"})}catch(e){const t=e instanceof Error?e.message:"Failed to bulk delete";throw p(`Bulk delete failed: ${t}`),e}},refetch:()=>{d("getRules")}}},B=({value:e,onChange:t,roles:r,label:s="Select Role",disabled:a=!1})=>{const l=[{label:"Select Role",value:""},...r.map(e=>({label:e.name,value:e.slug}))];return(0,u.jsx)(d.SelectControl,{label:s,value:e,options:l,onChange:t,disabled:a})},E=()=>{const[e,t]=(0,a.useState)([]),[r,s]=(0,a.useState)(!1),l=async()=>{s(!0);try{const e=await n()({path:"/wc/v3/products/categories?per_page=999"});t(e)}catch(e){console.error("Error fetching categories:",e),t([])}finally{s(!1)}};return(0,a.useEffect)(()=>{l()},[]),{categories:e,isLoading:r,fetchCategories:l}},T=({value:e,onChange:t,label:r="Categories"})=>{const{categories:s,isLoading:l}=E(),[n,i]=(0,a.useState)(!1),[o,c]=(0,a.useState)(""),p=(0,a.useMemo)(()=>s.filter(t=>e.includes(t.id)),[s,e]),h=(0,a.useMemo)(()=>o?s.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())):s,[s,o]);return(0,u.jsxs)("div",{className:"crp-category-multiselect",children:[(0,u.jsx)("label",{className:"components-base-control__label",children:r}),(0,u.jsx)("div",{className:"selected-categories",style:{marginBottom:"8px",display:"flex",flexWrap:"wrap",gap:"4px"},children:0===p.length?(0,u.jsx)("span",{style:{color:"#757575",fontSize:"13px"},children:"No categories selected"}):p.map(r=>(0,u.jsxs)("span",{className:"category-tag",style:{display:"inline-flex",alignItems:"center",padding:"4px 8px",background:"#f0f0f0",borderRadius:"4px",fontSize:"12px",gap:"6px"},children:[r.name,(0,u.jsx)("button",{onClick:()=>(r.id,void t(e)),style:{border:"none",background:"transparent",cursor:"pointer",padding:0,fontSize:"14px",lineHeight:1},"aria-label":`Remove ${r.name}`,children:"×"})]},r.id))}),(0,u.jsx)(d.Button,{variant:"secondary",onClick:()=>i(!n),children:n?"Close":"Select Categories"}),n&&(0,u.jsx)(d.Popover,{position:"bottom left",onClose:()=>i(!1),className:"crp-category-popover",children:(0,u.jsxs)("div",{style:{width:"300px",padding:"12px"},children:[(0,u.jsx)(d.TextControl,{label:"Search",value:o,onChange:c,placeholder:"Search categories..."}),l?(0,u.jsx)("p",{children:"Loading categories..."}):(0,u.jsx)("div",{style:{maxHeight:"300px",overflowY:"auto",marginTop:"8px"},children:0===h.length?(0,u.jsx)("p",{style:{color:"#757575",fontSize:"13px"},children:"No categories found"}):h.map(t=>(0,u.jsx)(d.CheckboxControl,{label:t.name,checked:e.includes(t.id),onChange:()=>handleToggle(t.id)},t.id))})]})})]})},L=[{label:"Select Type",value:""},{label:"Percentage Discount",value:"percentage"},{label:"Fixed Amount Discount",value:"fixed"},{label:"Fixed Price",value:"fixed_price"}],q=({isOpen:e,title:t,message:r,onConfirm:s,onCancel:a,isDangerous:l=!1})=>e?(0,u.jsxs)(d.Modal,{title:t,onRequestClose:a,className:"crp-confirm-dialog",children:[(0,u.jsx)("p",{children:r}),(0,u.jsxs)("div",{className:"crp-modal-actions",style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[(0,u.jsx)(d.Button,{onClick:a,children:"Cancel"}),(0,u.jsx)(d.Button,{variant:"primary",onClick:s,isDestructive:l,children:"Confirm"})]})]}):null,P=({roleFilter:e})=>{const[t,r]=(0,a.useState)(""),s=e||t,{roles:l,isLoading:n}=c(),{rules:i,isLoading:o,createRule:p,updateRule:h,deleteRule:g,toggleActive:x}=N(s),y=i.length>0?i[0]:null,[m,j]=(0,a.useState)(!1),[v,_]=(0,a.useState)(!1),[f,b]=(0,a.useState)({global_rule:y?.global_rule||{type:"",value:""},category_rule:y?.category_rule||{type:"",value:""},categories:y?.categories||[]});return(0,a.useState)(()=>{y&&b({global_rule:y.global_rule||{type:"",value:""},category_rule:y.category_rule||{type:"",value:""},categories:y.categories||[]})}),(0,u.jsxs)("div",{className:"crp-rules-tab",children:[!e&&(0,u.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,u.jsx)("h2",{children:"General Pricing Rules"}),(0,u.jsx)("p",{children:"Configure global pricing rules and category-specific rules for a role."})]}),!e&&(0,u.jsx)("div",{style:{marginBottom:"20px"},children:(0,u.jsx)("div",{style:{maxWidth:"300px"},children:(0,u.jsx)(B,{value:s,onChange:r,roles:l,label:"Select Role",disabled:n})})}),s&&o&&(0,u.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"40px"},children:(0,u.jsx)(d.Spinner,{})}),s&&!o&&!y&&(0,u.jsx)(d.Card,{children:(0,u.jsxs)(d.CardBody,{children:[(0,u.jsxs)("h3",{children:["Create Rule for ",s]}),(0,u.jsx)("p",{style:{color:"#757575",fontSize:"13px"},children:"No rule exists for this role yet. Create one to configure pricing settings."}),(0,u.jsx)(d.Button,{variant:"primary",onClick:async()=>{if(s){_(!0);try{await p({role:s,rule_type:"percentage",rule_value:"0",active:!0})}catch(e){console.error("Failed to create rule:",e)}finally{_(!1)}}},isBusy:v,disabled:v,children:"Create Rule"})]})}),s&&!o&&y&&(0,u.jsx)(d.Card,{children:(0,u.jsxs)(d.CardBody,{children:[(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,u.jsxs)("h3",{style:{margin:0},children:["Pricing Rule for ",y.role_name]}),(0,u.jsx)(d.ToggleControl,{label:"Active",checked:y.rule_active,onChange:async()=>{y&&await x(y.id)}})]}),(0,u.jsx)("h4",{children:"Global Rule"}),(0,u.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"24px"},children:[(0,u.jsx)(d.SelectControl,{label:"Rule Type",value:f.global_rule?.type||"",options:L,onChange:e=>b({...f,global_rule:{...f.global_rule,type:e}})}),(0,u.jsx)(d.TextControl,{label:"Value",value:f.global_rule?.value||"",onChange:e=>b({...f,global_rule:{...f.global_rule,value:e}}),placeholder:"e.g., 10"})]}),(0,u.jsx)("h4",{children:"Category Rule"}),(0,u.jsx)("div",{style:{marginBottom:"16px"},children:(0,u.jsx)(T,{value:f.categories||[],onChange:e=>b({...f,categories:e}),label:"Apply to Categories"})}),f.categories&&f.categories.length>0&&(0,u.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"24px"},children:[(0,u.jsx)(d.SelectControl,{label:"Category Rule Type",value:f.category_rule?.type||"",options:L,onChange:e=>b({...f,category_rule:{...f.category_rule,type:e}})}),(0,u.jsx)(d.TextControl,{label:"Category Value",value:f.category_rule?.value||"",onChange:e=>b({...f,category_rule:{...f.category_rule,value:e}}),placeholder:"e.g., 15"})]}),(0,u.jsxs)("div",{style:{display:"flex",gap:"10px",marginTop:"24px"},children:[(0,u.jsx)(d.Button,{variant:"primary",onClick:async()=>{if(y){_(!0);try{await h(y.id,f)}catch(e){console.error("Failed to save rule:",e)}finally{_(!1)}}},isBusy:v,disabled:v,children:"Save Changes"}),(0,u.jsx)(d.Button,{variant:"secondary",isDestructive:!0,onClick:()=>j(!0),disabled:v,children:"Delete Rule"})]})]})}),!s&&(0,u.jsx)("div",{className:"crp-empty-state",children:(0,u.jsx)("p",{className:"crp-empty-state__text",children:"Please select a role to configure pricing rules."})}),(0,u.jsx)(q,{isOpen:m,title:"Delete Rule",message:"Are you sure you want to delete this rule? This action cannot be undone.",onConfirm:async()=>{if(y)try{await g(y.id),j(!1)}catch(e){console.error("Failed to delete rule:",e)}},onCancel:()=>j(!1),isDangerous:!0})]})},F=({ruleId:e,categoryName:t,formData:r,onChange:s,onSelect:a,isSelected:l,hasChanges:n})=>(0,u.jsxs)("tr",{className:`${l?"selected-row":""} ${n?"has-changes":""}`,children:[(0,u.jsx)("td",{style:{width:"40px",textAlign:"center"},children:(0,u.jsx)(d.CheckboxControl,{checked:l,onChange:t=>a(e,t),__nextHasNoMarginBottom:!0})}),(0,u.jsxs)("td",{style:{minWidth:"150px"},children:[(0,u.jsx)("strong",{children:t}),n&&(0,u.jsx)("div",{style:{fontSize:"11px",color:"#d63638",marginTop:"4px"},children:"● Unsaved changes"})]}),(0,u.jsx)("td",{style:{minWidth:"150px"},children:(0,u.jsx)(d.SelectControl,{value:r.rule_type,options:L,onChange:t=>s(e,"rule_type",t),__nextHasNoMarginBottom:!0})}),(0,u.jsx)("td",{style:{minWidth:"100px"},children:(0,u.jsx)(d.TextControl,{value:r.rule_value,onChange:t=>s(e,"rule_value",t),placeholder:"0",type:"text",__nextHasNoMarginBottom:!0})}),(0,u.jsx)("td",{style:{minWidth:"100px"},children:(0,u.jsx)(d.TextControl,{value:r.category_value,onChange:t=>s(e,"category_value",t),placeholder:"0",type:"text",__nextHasNoMarginBottom:!0})}),(0,u.jsx)("td",{style:{minWidth:"100px"},children:(0,u.jsx)(d.TextControl,{value:String(r.min_quantity),onChange:t=>s(e,"min_quantity",parseInt(t)||0),placeholder:"0",type:"number",__nextHasNoMarginBottom:!0})}),(0,u.jsx)("td",{style:{minWidth:"150px"},children:(0,u.jsx)(d.SelectControl,{value:r.qty_rule_type,options:L,onChange:t=>s(e,"qty_rule_type",t),__nextHasNoMarginBottom:!0})}),(0,u.jsx)("td",{style:{minWidth:"100px"},children:(0,u.jsx)(d.TextControl,{value:r.qty_rule_value,onChange:t=>s(e,"qty_rule_value",t),placeholder:"0",type:"text",__nextHasNoMarginBottom:!0})})]}),D=({rules:e,categories:t,isLoading:r,roleFilter:s,onUpdate:l,onBulkUpdate:i,onBulkDelete:o,onRefetch:c})=>{const[p,h]=(0,a.useState)([]),[g,x]=(0,a.useState)(""),[y,m]=(0,a.useState)(""),[j,v]=(0,a.useState)(""),[_,f]=(0,a.useState)(!1),[b,C]=(0,a.useState)(new Map),[w,S]=(0,a.useState)(new Set),[R,k]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const t=new Map;e.forEach(e=>{if(b.has(e.id))t.set(e.id,b.get(e.id));else{const r=e.single_categories?.[0];t.set(e.id,{rule_type:r?.rule?.type||"",rule_value:r?.rule?.value||"",category_value:"",min_quantity:r?.min_qty||0,qty_rule_type:r?.rule?.quantity_type||"",qty_rule_value:r?.rule?.quantity||""})}}),C(t)},[e]);const N=(e,t,r)=>{const s=b.get(e);if(!s)return;const a={...s,[t]:r},l=new Map(b);l.set(e,a),C(l);const n=new Set(w);n.add(e),S(n)},B=(0,a.useMemo)(()=>g?e.filter(e=>{const r=e.single_categories||[];return t.filter(e=>r.includes(e.id)&&e.name.toLowerCase().includes(g.toLowerCase())).length>0}):e,[e,g,t]),E=(e,t)=>{h(t?[...p,e]:p.filter(t=>t!==e))},T=e=>{const t=e.single_categories||[];return 0===t.length?"No categories":t.map(e=>e.name||e.slug||"Unknown").join(", ")||"Unknown"};return r?(0,u.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"40px"},children:(0,u.jsx)(d.Spinner,{})}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{style:{marginBottom:"16px",display:"flex",gap:"10px",alignItems:"flex-end",flexWrap:"wrap"},children:[(0,u.jsx)("div",{style:{flex:"1",minWidth:"200px"},children:(0,u.jsx)(d.TextControl,{label:"Search Categories",value:g,onChange:x,placeholder:"Filter by category name..."})}),p.length>0&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{style:{minWidth:"150px"},children:(0,u.jsx)(d.SelectControl,{label:"Bulk Rule Type",value:y,options:L,onChange:m})}),(0,u.jsx)(d.Button,{variant:"secondary",onClick:async()=>{0!==p.length&&y&&(await i(p,{rule_type:y}),m(""))},disabled:!y,children:"Apply Type"}),(0,u.jsx)("div",{style:{minWidth:"100px"},children:(0,u.jsx)(d.TextControl,{label:"Bulk Value",value:j,onChange:v,placeholder:"e.g., 10"})}),(0,u.jsx)(d.Button,{variant:"secondary",onClick:async()=>{0!==p.length&&j&&(await i(p,{rule_value:j}),v(""))},disabled:!j,children:"Apply Value"}),(0,u.jsxs)(d.Button,{variant:"secondary",isDestructive:!0,onClick:()=>f(!0),children:["Delete (",p.length,")"]})]})]}),w.size>0&&(0,u.jsxs)("div",{className:"crp-save-banner",children:[(0,u.jsxs)("span",{className:"crp-save-banner__message",children:[(0,u.jsx)("strong",{children:w.size})," unsaved change",1!==w.size?"s":""]}),(0,u.jsxs)("div",{className:"crp-save-banner__actions",children:[(0,u.jsx)(d.Button,{variant:"secondary",onClick:()=>window.location.reload(),disabled:R,children:"Discard Changes"}),(0,u.jsx)(d.Button,{variant:"primary",onClick:async()=>{if(0!==w.size){k(!0);try{for(const t of Array.from(w)){const r=e.find(e=>e.id===t);if(!r)continue;const s=r.single_categories?.map(e=>{const r=b.get(t);return{category_id:e.id,type:r?.rule_type||e.rule?.type||"percentage",value:r?.rule_value||e.rule?.value||"0",min_qty:r?.min_quantity||e.min_qty||0,quantity:r?.qty_rule_value||e.rule?.quantity||"",quantity_type:r?.qty_rule_type||e.rule?.quantity_type||""}})||[];await n()({path:`/rrb2b/v1/rules/${t}/categories`,method:"PUT",data:{rows:s}})}S(new Set),c&&c()}catch(e){console.error("Failed to save changes:",e)}finally{k(!1)}}},isBusy:R,disabled:R,children:"Save All Changes"})]})]}),0===B.length?(0,u.jsx)("div",{style:{padding:"40px",textAlign:"center",background:"#f9f9f9",borderRadius:"4px"},children:(0,u.jsx)("p",{style:{margin:0,color:"#757575"},children:g?"No categories match your search.":"No category rules found."})}):(0,u.jsx)("div",{style:{overflowX:"auto"},children:(0,u.jsxs)("table",{className:"wp-list-table widefat fixed striped",style:{minWidth:"1200px"},children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{style:{width:"40px"},children:(0,u.jsx)("input",{type:"checkbox",checked:p.length===B.length&&B.length>0,onChange:()=>{p.length===B.length?h([]):h(B.map(e=>e.id))}})}),(0,u.jsx)("th",{children:"Category"}),(0,u.jsx)("th",{children:"Rule Type"}),(0,u.jsx)("th",{children:"Value"}),(0,u.jsx)("th",{children:"Cat. Value"}),(0,u.jsx)("th",{children:"Min Qty"}),(0,u.jsx)("th",{children:"Qty Rule Type"}),(0,u.jsx)("th",{children:"Qty Value"}),(0,u.jsx)("th",{children:"Actions"})]})}),(0,u.jsx)("tbody",{children:B.map(e=>{const t=b.get(e.id)||{rule_type:"",rule_value:"",category_value:"",min_quantity:0,qty_rule_type:"",qty_rule_value:""};return(0,u.jsx)(F,{ruleId:e.id,categoryName:T(e),formData:t,onChange:N,onSelect:E,isSelected:p.includes(e.id),hasChanges:w.has(e.id)},e.id)})})]})}),(0,u.jsx)(q,{isOpen:_,title:"Delete Selected Rules",message:`Are you sure you want to delete ${p.length} selected rule(s)? This action cannot be undone.`,onConfirm:async()=>{0!==p.length&&(await o(p),h([]),f(!1))},onCancel:()=>f(!1),isDangerous:!0})]})},A=({roleFilter:e})=>{const[t,r]=(0,a.useState)(""),[s,l]=(0,a.useState)(!1),[i,o]=(0,a.useState)([]),[p,h]=(0,a.useState)(!1),g=e||t,{roles:x,isLoading:y}=c(),{categories:m,isLoading:j}=E(),{rules:v,isLoading:_,createRule:f,updateRule:b,bulkUpdate:C,bulkDelete:w,refetch:S}=N(g),R=v.filter(e=>e.single_categories&&e.single_categories.length>0);return(0,u.jsxs)("div",{className:"crp-categories-tab",children:[!e&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,u.jsx)("h2",{children:"Category Pricing Rules"}),(0,u.jsx)("p",{children:"Configure role-based pricing rules for specific product categories."})]}),(0,u.jsx)("div",{style:{marginBottom:"20px"},children:(0,u.jsx)(B,{value:g,onChange:r,roles:x,label:"Filter by Role",disabled:y})})]}),(0,u.jsx)("div",{style:{marginBottom:"20px"},children:(0,u.jsx)(d.Button,{variant:"secondary",onClick:()=>l(!s),disabled:!g&&!e,children:s?"Cancel":"+ Add Category Rules"})}),s&&(0,u.jsx)(d.Card,{style:{marginBottom:"20px"},children:(0,u.jsxs)(d.CardBody,{children:[(0,u.jsx)("h3",{children:"Add Category Rules"}),(0,u.jsx)(T,{value:i,onChange:o}),(0,u.jsxs)("div",{style:{marginTop:"15px",display:"flex",gap:"10px"},children:[(0,u.jsx)(d.Button,{variant:"primary",onClick:async()=>{if(g&&0!==i.length){h(!0);try{const e=v.find(e=>e.role_name===g);if(e){const t=[...(e.single_categories||[]).map(e=>({category_id:e.id,type:e.rule?.type||"percentage",value:e.rule?.value||"0",min_qty:e.min_qty||0})),...i.map(e=>({category_id:e,type:"percentage",value:"0",min_qty:0}))];await n()({path:`/rrb2b/v1/rules/${e.id}/categories`,method:"PUT",data:{rows:t}}),S()}else await f({role:g,rule_type:"percentage",rule_value:"0",active:!0,single_categories:i});o([]),l(!1)}catch(e){console.error("Failed to add category rules:",e)}finally{h(!1)}}},isBusy:p,disabled:0===i.length||p,children:"Add Selected Categories"}),(0,u.jsx)(d.Button,{variant:"tertiary",onClick:()=>l(!1),children:"Cancel"})]}),(0,u.jsx)("p",{style:{marginTop:"10px",fontSize:"13px",color:"#757575"},children:"Select categories and configure pricing rules in the table below."})]})}),(0,u.jsx)(D,{rules:R,categories:m,isLoading:_||j,roleFilter:g,onUpdate:b,onBulkUpdate:C,onBulkDelete:w,onRefetch:S})]})},U=({ruleId:e,product:t,formData:r,onChange:s,onSelect:a,isSelected:l,hasChanges:n})=>{const i=["crp-product-row",l&&"selected-row",n&&"has-changes"].filter(Boolean).join(" ");return(0,u.jsxs)("tr",{className:i,children:[(0,u.jsx)("td",{className:"crp-table__checkbox-cell",children:(0,u.jsx)(d.CheckboxControl,{checked:l,onChange:t=>a(e,t),__nextHasNoMarginBottom:!0})}),(0,u.jsx)("td",{className:"crp-product-row__thumbnail-cell",children:t?.thumbnail&&(0,u.jsx)("img",{src:t.thumbnail,alt:t.name,className:"crp-product-row__thumbnail"})}),(0,u.jsxs)("td",{className:"crp-product-row__name-cell",children:[(0,u.jsx)("strong",{children:t?.name||"Unknown Product"}),t?.sku&&(0,u.jsxs)("div",{className:"crp-product-row__sku",children:["SKU: ",t.sku]}),n&&(0,u.jsx)("div",{className:"crp-product-row__unsaved-indicator",children:"● Unsaved changes"})]}),(0,u.jsx)("td",{children:(0,u.jsx)(d.SelectControl,{value:r.rule_type,options:L,onChange:t=>s(e,"rule_type",t),__nextHasNoMarginBottom:!0})}),(0,u.jsx)("td",{children:(0,u.jsx)(d.TextControl,{value:r.rule_value,onChange:t=>s(e,"rule_value",t),placeholder:"0",type:"text",__nextHasNoMarginBottom:!0})}),(0,u.jsx)("td",{children:(0,u.jsx)(d.TextControl,{value:String(r.min_quantity),onChange:t=>s(e,"min_quantity",parseInt(t)||0),placeholder:"0",type:"number",__nextHasNoMarginBottom:!0})}),(0,u.jsx)("td",{children:(0,u.jsx)(d.SelectControl,{value:r.qty_rule_type,options:L,onChange:t=>s(e,"qty_rule_type",t),__nextHasNoMarginBottom:!0})}),(0,u.jsx)("td",{children:(0,u.jsx)(d.TextControl,{value:r.qty_rule_value,onChange:t=>s(e,"qty_rule_value",t),placeholder:"0",type:"text",__nextHasNoMarginBottom:!0})})]})},M=({rules:e,products:t,isLoading:r,roleFilter:s,onUpdate:l,onBulkUpdate:i,onBulkDelete:o,onAddProduct:c,onRefetch:p})=>{const[h,g]=(0,a.useState)([]),[x,y]=(0,a.useState)(""),[m,j]=(0,a.useState)(""),[v,_]=(0,a.useState)(""),[f,b]=(0,a.useState)(!1),[C,w]=(0,a.useState)(new Map),[S,R]=(0,a.useState)(new Set),[k,N]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const t=new Map;e.forEach(e=>{if(C.has(e.id))t.set(e.id,C.get(e.id));else{const r=e.products?.[0];t.set(e.id,{rule_type:r?.rule?.type||"",rule_value:r?.rule?.value||"",min_quantity:r?.min_qty||0,qty_rule_type:r?.rule?.quantity_type||"",qty_rule_value:r?.rule?.quantity||""})}}),w(t)},[e]);const B=(0,a.useMemo)(()=>x?e.filter(e=>(e.products||[]).some(e=>{const r=x.toLowerCase();if(e.name&&e.name.toLowerCase().includes(r))return!0;const s=t.get(e.id);return!(!s?.sku||!s.sku.toLowerCase().includes(r))})):e,[e,x,t]),E=(e,t)=>{g(t?[...h,e]:h.filter(t=>t!==e))},T=(e,t,r)=>{const s=C.get(e);if(!s)return;const a={...s,[t]:r},l=new Map(C);l.set(e,a),w(l);const n=new Set(S);n.add(e),R(n)};return r?(0,u.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"40px"},children:(0,u.jsx)(d.Spinner,{})}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{style:{marginBottom:"16px"},children:(0,u.jsx)("div",{style:{maxWidth:"300px"},children:(0,u.jsx)(d.TextControl,{label:"Filter Existing Rules",value:x,onChange:y,placeholder:"Filter by product name or SKU...",help:"Search within the table below"})})}),h.length>0&&(0,u.jsx)("div",{style:{marginBottom:"16px"},children:(0,u.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"flex-end",flexWrap:"wrap"},children:[(0,u.jsx)("div",{style:{minWidth:"150px"},children:(0,u.jsx)(d.SelectControl,{label:"Bulk Rule Type",value:m,options:L,onChange:j})}),(0,u.jsx)(d.Button,{variant:"secondary",onClick:async()=>{0!==h.length&&m&&(await i(h,{rule_type:m}),j(""))},disabled:!m,children:"Apply Type"}),(0,u.jsx)("div",{style:{minWidth:"100px"},children:(0,u.jsx)(d.TextControl,{label:"Bulk Value",value:v,onChange:_,placeholder:"e.g., 10"})}),(0,u.jsx)(d.Button,{variant:"secondary",onClick:async()=>{0!==h.length&&v&&(await i(h,{rule_value:v}),_(""))},disabled:!v,children:"Apply Value"}),(0,u.jsxs)(d.Button,{variant:"secondary",isDestructive:!0,onClick:()=>b(!0),children:["Delete (",h.length,")"]})]})}),S.size>0&&(0,u.jsxs)("div",{className:"crp-save-banner",children:[(0,u.jsxs)("span",{className:"crp-save-banner__message",children:[(0,u.jsx)("strong",{children:S.size})," unsaved change",1!==S.size?"s":""]}),(0,u.jsxs)("div",{className:"crp-save-banner__actions",children:[(0,u.jsx)(d.Button,{variant:"secondary",onClick:()=>window.location.reload(),disabled:k,children:"Discard Changes"}),(0,u.jsx)(d.Button,{variant:"primary",onClick:async()=>{if(0!==S.size){N(!0);try{for(const t of Array.from(S)){const r=e.find(e=>e.id===t);if(!r)continue;const s=r.products?.map(e=>{const r=C.get(t);return{product_id:e.id,product_name:e.name,type:r?.rule_type||e.rule?.type||"percentage",value:r?.rule_value||e.rule?.value||"0",min_qty:r?.min_quantity||e.min_qty||1,quantity:r?.qty_rule_value||e.rule?.quantity||"",quantity_type:r?.qty_rule_type||e.rule?.quantity_type||""}})||[];await n()({path:`/rrb2b/v1/rules/${t}/products`,method:"PUT",data:{rows:s}})}R(new Set),p&&p()}catch(e){console.error("Failed to save changes:",e)}finally{N(!1)}}},isBusy:k,disabled:k,children:"Save All Changes"})]})]}),0===B.length?(0,u.jsx)("div",{className:"crp-empty-state",children:(0,u.jsx)("p",{className:"crp-empty-state__text",children:x?"No products match your search.":"No product rules found. Add products using the search above."})}):(0,u.jsx)("div",{className:"crp-table-container",children:(0,u.jsxs)("table",{className:"wp-list-table widefat fixed striped crp-table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{style:{width:"40px"},children:(0,u.jsx)("input",{type:"checkbox",checked:h.length===B.length&&B.length>0,onChange:()=>{h.length===B.length?g([]):g(B.map(e=>e.id))}})}),(0,u.jsx)("th",{style:{width:"60px"},children:"Image"}),(0,u.jsx)("th",{children:"Product"}),(0,u.jsx)("th",{children:"Rule Type"}),(0,u.jsx)("th",{children:"Value"}),(0,u.jsx)("th",{children:"Minimum Quantity"}),(0,u.jsx)("th",{children:"Quantity Rule Type"}),(0,u.jsx)("th",{children:"Quantity Value"})]})}),(0,u.jsx)("tbody",{children:B.map(e=>{const r=e.products?.[0],s=r?{id:r.id,name:r.name,sku:"",thumbnail:t.get(r.id)?.thumbnail||""}:null,a=C.get(e.id)||{rule_type:"",rule_value:"",min_quantity:0,qty_rule_type:"",qty_rule_value:""};return(0,u.jsx)(U,{ruleId:e.id,product:s,formData:a,onChange:T,onSelect:E,isSelected:h.includes(e.id),hasChanges:S.has(e.id)},e.id)})})]})}),(0,u.jsx)(q,{isOpen:f,title:"Delete Selected Rules",message:`Are you sure you want to delete ${h.length} selected rule(s)? This action cannot be undone.`,onConfirm:async()=>{0!==h.length&&(await o(h),g([]),b(!1))},onCancel:()=>b(!1),isDangerous:!0})]})},$=window.wp.compose,O=({onSelect:e,ruleId:t,placeholder:r="Search products..."})=>{const[s,l]=(0,a.useState)(""),[i,o]=(0,a.useState)([]),[c,p]=(0,a.useState)(!1),[h,g]=(0,a.useState)(!1),{searchProducts:x}=(()=>{const[e,t]=(0,a.useState)(!1);return{searchProducts:async(e,r)=>{if(!e||e.length<2)return[];t(!0);try{return r?await n()({path:`/rrb2b/v1/rules/${r}/products/search`,method:"POST",data:{search:e}}):(await n()({path:`/wc/v3/products?search=${encodeURIComponent(e)}&per_page=20`})).map(e=>({id:e.id,name:e.name,sku:e.sku,price:e.price,thumbnail:e.images?.[0]?.src||""}))}catch(e){return console.error("Error searching products:",e),[]}finally{t(!1)}},getProductsByCategory:async e=>{t(!0);try{return(await n()({path:`/wc/v3/products?category=${e}&per_page=100`})).map(e=>({id:e.id,name:e.name,sku:e.sku,price:e.price,thumbnail:e.images?.[0]?.src||""}))}catch(e){return console.error("Error fetching products by category:",e),[]}finally{t(!1)}},isSearching:e}})(),y=(0,a.useMemo)(()=>(0,$.debounce)(async e=>{if(e.length<2)return o([]),void g(!1);g(!0);const r=await x(e,t);o(r),p(!0),g(!1)},300),[t,x]);return(0,a.useEffect)(()=>{s.length>=2&&g(!0),y(s)},[s,y]),(0,u.jsxs)("div",{className:"crp-product-search",children:[(0,u.jsx)(d.TextControl,{label:"Search Products",value:s,onChange:l,placeholder:r,autoComplete:"off"}),h&&(0,u.jsx)("div",{className:"crp-product-search__spinner",children:(0,u.jsx)(d.Spinner,{})}),c&&i.length>0&&(0,u.jsx)("div",{className:"crp-product-search__results",children:i.map(t=>(0,u.jsxs)("button",{onClick:()=>(t=>{e(t),l(""),o([]),p(!1)})(t),className:"crp-product-search__result-item",children:[t.thumbnail&&(0,u.jsx)("img",{src:t.thumbnail,alt:t.name,className:"crp-product-search__result-thumbnail"}),(0,u.jsxs)("div",{className:"crp-product-search__result-details",children:[(0,u.jsx)("div",{className:"crp-product-search__result-name",children:t.name}),t.sku&&(0,u.jsxs)("div",{className:"crp-product-search__result-sku",children:["SKU: ",t.sku]})]}),t.price&&(0,u.jsxs)("div",{className:"crp-product-search__result-price",children:["$",t.price]})]},t.id))}),s.length>=2&&0===i.length&&!h&&(0,u.jsx)("div",{className:"crp-product-search__no-results",children:"No products found"})]})},I=({isOpen:e,onClose:t,onAddProduct:r,onAddFromCategory:s,categories:l})=>{const[i,o]=(0,a.useState)([]),[c,p]=(0,a.useState)(!1),[h,g]=(0,a.useState)(!1),[x,y]=(0,a.useState)([]),[m,j]=(0,a.useState)(!1);(0,a.useEffect)(()=>{e&&0===x.length&&v()},[e]);const v=async()=>{j(!0);try{const e=(await n()({path:"/wc/v3/products?per_page=10&orderby=popularity&order=desc"})).map(e=>({id:e.id,name:e.name,sku:e.sku,price:e.price,thumbnail:e.images?.[0]?.src||""}));y(e)}catch(e){console.error("Failed to load suggested products:",e)}finally{j(!1)}},_=async()=>{if(0!==i.length){g(!0);try{await s(i,c),o([]),p(!1),t()}catch(e){console.error("Failed to add products from category:",e)}finally{g(!1)}}},f=async e=>{g(!0);try{await r(e),t()}catch(e){console.error("Failed to add product:",e)}finally{g(!1)}};return e?(0,u.jsx)(d.Modal,{title:"Add Product Rules",onRequestClose:t,className:"crp-add-product-modal",children:(0,u.jsx)(d.TabPanel,{className:"crp-add-product-tabs",tabs:[{name:"search",title:"Add Products"},{name:"category",title:"Add from Category"}],children:e=>"search"===e.name?(0,u.jsxs)("div",{className:"crp-add-product-tabs",children:[(0,u.jsx)("p",{className:"crp-modal__description",children:"Search and select products to add pricing rules."}),(0,u.jsx)(O,{onSelect:f,placeholder:"Search for products..."}),m?(0,u.jsxs)("div",{style:{padding:"20px",textAlign:"center"},children:[(0,u.jsx)(d.Spinner,{}),(0,u.jsx)("p",{children:"Loading suggested products..."})]}):x.length>0&&(0,u.jsxs)("div",{style:{marginTop:"20px"},children:[(0,u.jsx)("h4",{children:"Suggested Products"}),(0,u.jsx)("div",{style:{display:"grid",gap:"8px"},children:x.map(e=>(0,u.jsxs)("button",{onClick:()=>f(e),className:"crp-product-search__result-item",style:{border:"1px solid #ddd",borderRadius:"4px"},children:[e.thumbnail&&(0,u.jsx)("img",{src:e.thumbnail,alt:e.name,className:"crp-product-search__result-thumbnail"}),(0,u.jsxs)("div",{className:"crp-product-search__result-details",children:[(0,u.jsx)("div",{className:"crp-product-search__result-name",children:e.name}),e.sku&&(0,u.jsxs)("div",{className:"crp-product-search__result-sku",children:["SKU: ",e.sku]})]}),e.price&&(0,u.jsxs)("div",{className:"crp-product-search__result-price",children:["$",e.price]})]},e.id))})]})]}):(0,u.jsxs)("div",{className:"crp-add-product-tabs",children:[(0,u.jsx)("p",{className:"crp-modal__description",children:"Select categories to add all products from those categories."}),l.length>0&&(0,u.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,u.jsx)("h4",{children:"Suggested Categories"}),(0,u.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:l.slice(0,6).map(e=>(0,u.jsx)(d.Button,{variant:"secondary",size:"small",onClick:()=>{i.includes(e.id)||o([...i,e.id])},disabled:i.includes(e.id),children:e.name},e.id))})]}),(0,u.jsx)(T,{value:i,onChange:o}),(0,u.jsx)("div",{className:"crp-modal__checkbox-label",children:(0,u.jsxs)("label",{children:[(0,u.jsx)("input",{type:"checkbox",checked:c,onChange:e=>p(e.target.checked),className:"crp-modal__checkbox-input"}),"Include product variations"]})}),(0,u.jsxs)("div",{className:"crp-modal__actions",children:[(0,u.jsx)(d.Button,{variant:"primary",onClick:_,isBusy:h,disabled:0===i.length||h,children:"Add Products from Categories"}),(0,u.jsx)(d.Button,{variant:"tertiary",onClick:t,disabled:h,children:"Cancel"})]})]})})}):null},W=({roleFilter:e})=>{const[t,r]=(0,a.useState)(""),[s,l]=(0,a.useState)(!1),i=e||t,{roles:o,isLoading:p}=c(),{categories:h,isLoading:g}=E(),{rules:x,isLoading:y,createRule:m,updateRule:j,bulkUpdate:v,bulkDelete:_,refetch:f}=N(i),[b,C]=(0,a.useState)(new Map),w=x.filter(e=>e.products&&e.products.length>0);(0,a.useEffect)(()=>{w.length>0&&(async()=>{const e=new Set;w.forEach(t=>{t.products?.forEach(t=>e.add(t.id))});const t=new Map(b),r=Array.from(e).filter(e=>!t.has(e));if(r.length>0)try{for(let e=0;e<r.length;e+=20){const s=r.slice(e,e+20);(await n()({path:`/wc/v3/products?include=${s.join(",")}`})).forEach(e=>{t.set(e.id,{id:e.id,name:e.name,sku:e.sku,price:e.price,thumbnail:e.images?.[0]?.src||""})})}C(t)}catch(e){console.error("Failed to fetch products:",e)}})()},[w.length]);const S=async e=>{if(!i)throw new Error("Please select a role first");const t=x.find(e=>e.role_name===i);if(t){const r=[...(t.products||[]).map(e=>({product_id:e.id,product_name:e.name||"",type:e.rule?.type||"percentage",value:e.rule?.value||"0",min_qty:e.min_qty||1})),{product_id:e.id,product_name:e.name,type:"percentage",value:"0",min_qty:1}];await n()({path:`/rrb2b/v1/rules/${t.id}/products`,method:"PUT",data:{rows:r}}),f()}else await m({role:i,rule_type:"percentage",rule_value:"0",active:!0,products:[e.id],productDetails:[{id:e.id,name:e.name}]});C(t=>new Map(t).set(e.id,e))};return(0,u.jsxs)("div",{className:"crp-products-tab",children:[!e&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,u.jsx)("h2",{children:"Product Pricing Rules"}),(0,u.jsx)("p",{children:"Configure role-based pricing rules for specific products."})]}),(0,u.jsx)("div",{style:{marginBottom:"20px"},children:(0,u.jsx)(B,{value:i,onChange:r,roles:o,label:"Filter by Role",disabled:p})})]}),(0,u.jsx)("div",{style:{marginBottom:"20px"},children:(0,u.jsx)(d.Button,{variant:"secondary",onClick:()=>l(!0),disabled:!i&&!e,children:"+ Add Product Rules"})}),(0,u.jsx)(I,{isOpen:s,onClose:()=>l(!1),onAddProduct:S,onAddFromCategory:async(e,t)=>{if(!i)throw new Error("Please select a role first");const r=x.find(e=>e.role_name===i);if(!r)throw new Error("Please create a rule for this role first");await n()({path:`/rrb2b/v1/rules/${r.id}/products/from-category`,method:"POST",data:{category:e[0],variations:t}}),f()},categories:h}),(0,u.jsx)(M,{rules:w,products:b,isLoading:y,roleFilter:i,onUpdate:j,onBulkUpdate:v,onBulkDelete:_,onAddProduct:S,onRefetch:f})]})},z=({role:e,onBack:t})=>(0,u.jsxs)("div",{className:"crp-rules-detail-view",style:{marginTop:"20px"},children:[(0,u.jsxs)("div",{style:{marginBottom:"20px",display:"flex",alignItems:"center",gap:"15px"},children:[(0,u.jsx)(d.Button,{variant:"secondary",onClick:t,icon:"arrow-left-alt2",children:"Back to Roles"}),(0,u.jsxs)("div",{children:[(0,u.jsxs)("h2",{style:{margin:0},children:["Pricing Rules for: ",e.name]}),(0,u.jsxs)("p",{style:{margin:"5px 0 0 0",color:"#666",fontSize:"13px"},children:["Role: ",e.slug]})]})]}),(0,u.jsx)(d.TabPanel,{className:"crp-rules-tabs",activeClass:"is-active",tabs:[{name:"general",title:"General Rules",className:"tab-general-rules"},{name:"categories",title:"Categories",className:"tab-categories"},{name:"products",title:"Products",className:"tab-products"}],children:t=>{switch(t.name){case"general":return(0,u.jsx)(P,{roleFilter:e.slug});case"categories":return(0,u.jsx)(A,{roleFilter:e.slug});case"products":return(0,u.jsx)(W,{roleFilter:e.slug});default:return null}}})]}),H=()=>{const e=new URLSearchParams(window.location.search).get("role"),[t,r]=(0,a.useState)(e),{roles:s,isLoading:l}=c();(0,a.useEffect)(()=>{e&&e!==t&&r(e)},[e]);const n=t?s.find(e=>e.slug===t):null;return n?(0,u.jsx)(z,{role:n,onBack:()=>{r(null);const e=new URL(window.location.href);e.searchParams.delete("role"),window.history.pushState({},"",e.toString())}}):(0,u.jsx)(p,{roles:s,isLoading:l,onSelectRole:e=>{r(e);const t=new URL(window.location.href);t.searchParams.set("role",e),window.history.pushState({},"",t.toString())}})};class V extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("React Error:",e,t)}render(){return this.state.hasError?(0,u.jsxs)("div",{className:"notice notice-error",style:{padding:"20px",margin:"20px 0"},children:[(0,u.jsx)("h3",{children:"Something went wrong"}),(0,u.jsx)("p",{children:"The admin interface encountered an error. Please refresh the page to try again."}),this.state.error&&(0,u.jsxs)("details",{style:{marginTop:"10px"},children:[(0,u.jsx)("summary",{children:"Error details"}),(0,u.jsx)("pre",{style:{marginTop:"10px",padding:"10px",background:"#f5f5f5",overflow:"auto"},children:this.state.error.toString()})]})]}):this.props.children}}const G=V,Q=()=>{const e=document.getElementById("rrb2b-rules-root");e&&(0,a.createRoot)(e).render((0,a.createElement)(G,null,(0,a.createElement)(H)))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Q):Q()})();
(()=>{"use strict";var e={n:r=>{var t=r&&r.__esModule?()=>r.default:()=>r;return e.d(t,{a:t}),t},d:(r,t)=>{for(var o in t)e.o(t,o)&&!e.o(r,o)&&Object.defineProperty(r,o,{enumerable:!0,get:t[o]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r)};const r=window.wp.element,t=window.wp.apiFetch;var o=e.n(t);const l=window.wp.data,s=window.wp.notices,n=window.wp.components,a=window.ReactJSXRuntime,i=({onCreate:e,allRoles:t=[],cloneFrom:o})=>{const[l,s]=(0,r.useState)(""),[i,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(o||"customer"),[h,m]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(o){u(o);const e=t.find(e=>e.slug===o);e&&(s(`${e.name} (Copy)`),c(p(`${e.name}_copy`)))}},[o,t]);const p=e=>e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,""),g=["administrator","editor","author","contributor","subscriber","customer","shop_manager"],x=[{label:"--- WordPress & WooCommerce Defaults ---",value:"",disabled:!0},{label:"Customer (WooCommerce)",value:"customer"},{label:"Shop Manager (WooCommerce)",value:"shop_manager"},{label:"Subscriber",value:"subscriber"},{label:"Contributor",value:"contributor"},{label:"Author",value:"author"},{label:"Editor",value:"editor"}],y=t.filter(e=>!g.includes(e.slug));return y.length>0&&(x.push({label:"--- Custom Roles ---",value:"",disabled:!0}),y.forEach(e=>{x.push({label:e.name,value:e.slug,disabled:!1})})),(0,a.jsx)(n.Card,{children:(0,a.jsxs)(n.CardBody,{children:[(0,a.jsx)("h3",{children:o?"Clone Role":"Create New Role"}),(0,a.jsxs)("form",{onSubmit:async r=>{if(r.preventDefault(),l.trim()&&i.trim()){m(!0);try{await e({name:l,slug:i,baseCap:d}),s(""),c(""),u("customer")}catch(e){console.error("Error creating role:",e)}finally{m(!1)}}},children:[(0,a.jsx)(n.TextControl,{label:"Role Name",value:l,onChange:e=>{s(e),i&&i!==p(l)||c(p(e))},placeholder:"e.g. Wholesale Customer",required:!0}),(0,a.jsx)(n.TextControl,{label:"Role Slug",value:i,onChange:c,placeholder:"e.g. wholesale_customer",help:"Used internally. Only lowercase letters, numbers, and underscores.",required:!0}),(0,a.jsx)(n.SelectControl,{label:"Base Capabilities (Clone From)",value:d,onChange:u,options:x,help:"The new role will inherit all capabilities from this role."}),(0,a.jsx)(n.Button,{variant:"primary",type:"submit",isBusy:h,disabled:h||!l.trim()||!i.trim(),children:o?"Create Cloned Role":"Create Role"})]})]})})},c=({roles:e,isLoading:t,onCreateRole:o,onDeleteRole:l,onSelectRole:s,showCreateForm:c=!0,showDeleteButton:d=!0,showManageRulesButton:u=!0})=>{const[h,m]=(0,r.useState)(null),[p,g]=(0,r.useState)(null);return t?(0,a.jsx)("div",{children:"Loading roles..."}):(0,a.jsxs)("div",{className:"crp-roles-list-view",children:[(0,a.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,a.jsx)("h2",{children:"Role Management"}),(0,a.jsx)("p",{children:"Create, delete, and clone custom roles for your B2B customers."})]}),c&&o&&(0,a.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,a.jsx)(i,{onCreate:o,allRoles:e,cloneFrom:p||void 0}),p&&(0,a.jsx)(n.Button,{variant:"link",onClick:()=>g(null),style:{marginTop:"10px"},children:"Cancel Clone"})]}),(0,a.jsx)(n.Card,{children:(0,a.jsxs)(n.CardBody,{children:[(0,a.jsx)("h3",{children:"All Roles"}),(0,a.jsxs)("table",{className:"wp-list-table widefat fixed striped",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{style:{width:"30%"},children:"Role Name"}),(0,a.jsx)("th",{style:{width:"20%"},children:"Slug"}),(0,a.jsx)("th",{style:{width:"15%"},children:"Users"}),(0,a.jsx)("th",{style:{width:"35%"},children:"Actions"})]})}),(0,a.jsx)("tbody",{children:0===e.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,style:{textAlign:"center",padding:"20px"},children:c?"No roles found. Create your first role above.":"No roles found."})}):e.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:(0,a.jsx)("strong",{children:e.name})}),(0,a.jsx)("td",{children:(0,a.jsx)("code",{children:e.slug})}),(0,a.jsx)("td",{children:e.user_count??0}),(0,a.jsxs)("td",{children:[u&&s&&(0,a.jsx)(n.Button,{variant:"primary",onClick:()=>s(e.slug),style:{marginRight:"8px"},children:"Manage Rules"}),c&&o&&(0,a.jsx)(n.Button,{variant:"secondary",onClick:()=>{return r=e.slug,g(r),void setTimeout(()=>{document.querySelector(".crp-roles-list-view")?.scrollIntoView({behavior:"smooth"})},100);var r},style:{marginRight:"8px"},children:"Clone"}),d&&l&&(0,a.jsx)(n.Button,{variant:"secondary",isDestructive:!0,onClick:()=>(async(e,r)=>{if(l&&confirm(`Are you sure you want to delete the role "${r}"? This will also delete all associated rules.`)){m(e);try{await l(e)}finally{m(null)}}})(e.slug,e.name),isBusy:h===e.slug,disabled:h===e.slug,children:"Delete"})]})]},e.slug))})]})]})})]})},d=()=>{const{roles:e,isLoading:t,createRole:n,deleteRole:i}=(()=>{const[e,t]=(0,r.useState)([]),[n,a]=(0,r.useState)(!1),{createSuccessNotice:i,createErrorNotice:c}=(0,l.useDispatch)(s.store),d=async()=>{a(!0);try{const e=await o()({path:"/rrb2b/v1/roles",method:"GET"});t(e)}catch(e){const r=e instanceof Error?e.message:"Unknown error";c(`Failed to load roles: ${r}`),console.error("Error fetching roles:",e)}finally{a(!1)}};return(0,r.useEffect)(()=>{d()},[]),{roles:e,isLoading:n,createRole:async r=>{try{const l={role_name:r.name,role_slug:r.slug,role_cap:r.baseCap||"customer"},s=(await o()({path:"/rrb2b/v1/roles",method:"POST",data:l})).role;return t([...e,s]),i("Role created successfully!",{type:"snackbar"}),s}catch(e){const r=e instanceof Error?e.message:"Unknown error";throw c(`Failed to create role: ${r}`),e}},deleteRole:async r=>{const l=[...e];t(e.filter(e=>e.slug!==r));try{await o()({path:`/rrb2b/v1/roles/${r}`,method:"DELETE"}),i("Role deleted successfully!",{type:"snackbar"})}catch(e){t(l);const r=e instanceof Error?e.message:"Unknown error";throw c(`Failed to delete role: ${r}`),e}},refetch:d}})();return(0,a.jsx)(c,{roles:e,isLoading:t,onSelectRole:()=>{},showCreateForm:!0,showDeleteButton:!0,showManageRulesButton:!1,onCreateRole:n,onDeleteRole:i})};class u extends r.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,r){console.error("React Error:",e,r)}render(){return this.state.hasError?(0,a.jsxs)("div",{className:"notice notice-error",style:{padding:"20px",margin:"20px 0"},children:[(0,a.jsx)("h3",{children:"Something went wrong"}),(0,a.jsx)("p",{children:"The admin interface encountered an error. Please refresh the page to try again."}),this.state.error&&(0,a.jsxs)("details",{style:{marginTop:"10px"},children:[(0,a.jsx)("summary",{children:"Error details"}),(0,a.jsx)("pre",{style:{marginTop:"10px",padding:"10px",background:"#f5f5f5",overflow:"auto"},children:this.state.error.toString()})]})]}):this.props.children}}const h=u,m=()=>{const e=document.getElementById("rrb2b-roles-root");e&&(0,r.createRoot)(e).render((0,r.createElement)(h,null,(0,r.createElement)(d)))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",m):m()})();